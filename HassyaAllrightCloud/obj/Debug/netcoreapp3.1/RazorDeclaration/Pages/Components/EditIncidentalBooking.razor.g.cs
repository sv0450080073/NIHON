#pragma checksum "E:\Project\HassyaAllrightCloud\Pages\Components\EditIncidentalBooking.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "3700e018d18b0e9905632bb59efbdc8d0a934f86"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace HassyaAllrightCloud.Pages.Components
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Infrastructure.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Dto;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Constants;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using BlazorContextMenu;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Application.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.IService;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor.Reporting;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 32 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 33 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal;

#line default
#line hidden
#nullable disable
#nullable restore
#line 34 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 35 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 37 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 38 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 39 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components.CommonComponents;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Project\HassyaAllrightCloud\Pages\Components\EditIncidentalBooking.razor"
using HassyaAllrightCloud.Commons.Extensions;

#line default
#line hidden
#nullable disable
    public partial class EditIncidentalBooking : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 343 "E:\Project\HassyaAllrightCloud\Pages\Components\EditIncidentalBooking.razor"
       
    [Parameter] public IncidentalViewMode CurrentViewMode { get; set; }
    [Parameter] public LoadFuttum LoadFuttumOrigin { get; set; }
    [Parameter] public bool IsEditMode { get; set; }

    [Parameter] public List<ScheduleSelectorModel> FutaiScheduleList { get; set; }
    [Parameter] public List<LoadTsumi> LoadTsumiList { get; set; }
    [Parameter] public List<LoadFutai> LoadFutaiList { get; set; }
    [Parameter] public List<LoadNyuRyokinName> LoadNyuRyokinNameList { get; set; }
    [Parameter] public List<LoadSeisanCd> LoadSeisanCdList { get; set; }
    [Parameter] public List<LoadSeisanKbn> LoadSeisanKbnList { get; set; }
    [Parameter] public List<LoadCustomerList> CustomerList { get; set; }
    [Parameter] public List<TaxTypeList> TaxTypeDataList { get; set; }
    [Parameter] public List<LoadDouro> LoadDouroDataList { get; set; }
    [Parameter] public List<SettingQuantity> SettingQuantityList { get; set; }
    [Parameter] public SettingTaxRate SettingTaxRate { get; set; }
    [Parameter] public EventCallback<int> OnSubmit { get; set; }
    [Parameter] public EventCallback<int> OnCancel { get; set; }
    protected EditContext FormContext { get; set; }
    protected LoadFuttum LoadFuttumModel { get; set; }
    protected bool ShowSettingQuantity { get; set; }
    protected string TempStr { get; set; }
    Dictionary<string, string> LangDic = new Dictionary<string, string>();
    private bool isChangeNyuDouro;
    private bool isChangeShuDouro;
    private void LocalizationInit()
    {
        var dataLang = Lang.GetAllStrings();
        LangDic = dataLang.ToDictionary(l => l.Name, l => l.Value);
    }

    protected override void OnInitialized()
    {
        LocalizationInit();
        if (IsEditMode)
        {
            LoadFuttumOrigin.FirstLoad = true;
            var json = JsonConvert.SerializeObject(LoadFuttumOrigin);
            LoadFuttumModel = JsonConvert.DeserializeObject<LoadFuttum>(json);
            LoadSelectedDataCombobox(LoadFuttumModel);
            LoadFuttumModel.FirstLoad = false;
        }
        else
        {
            LoadFuttumModel = LoadFuttumOrigin;
        }
        FormContext = new EditContext(LoadFuttumModel);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        JSRuntime.InvokeVoidAsync("setEventforCurrencyField");
        JSRuntime.InvokeAsync<string>("loadPageScript", "bookingInputPage", "futaiEnterKey");
        JSRuntime.InvokeAsync<string>("loadPageScript", "bookingInputPage", "futaiTabKey");
    }

    protected bool IsEnableSaveButton()
    {
        return FormContext.IsModified() && FormContext.Validate();
    }

    private void LoadSelectedDataCombobox(LoadFuttum loadFuttum)
    {
        if (LoadSeisanKbnList != null && loadFuttum.SelectedLoadSeisanKbn != null)
        {
            loadFuttum.SelectedLoadSeisanKbn =
                LoadSeisanKbnList.SingleOrDefault(s => byte.Parse(s.CodeKbn) == byte.Parse(loadFuttum.SelectedLoadSeisanKbn.CodeKbn));
        }
        if (LoadSeisanCdList != null && loadFuttum.SelectedLoadSeisanCd != null)
        {
            loadFuttum.SelectedLoadSeisanCd =
                LoadSeisanCdList.SingleOrDefault(s => s.SeisanCdSeq == loadFuttum.SelectedLoadSeisanCd.SeisanCdSeq);
        }
        if (CustomerList != null)
        {
            if (loadFuttum.SelectedCustomer != null && loadFuttum.SelectedCustomer.SitenCdSeq != 0 && loadFuttum.SelectedCustomer.TokuiSeq != 0)
            {
                loadFuttum.SelectedCustomer =
                    CustomerList.Skip(1).SingleOrDefault(s => s.SitenCdSeq == loadFuttum.SelectedCustomer.SitenCdSeq && s.TokuiSeq == loadFuttum.SelectedCustomer.TokuiSeq);
            }
            else
            {
                loadFuttum.SelectedCustomer = CustomerList.FirstOrDefault();
            }
        }
        if (LoadNyuRyokinNameList != null)
        {
            if (loadFuttum.SelectedLoadNyuRyokinName != null)
            {
                loadFuttum.SelectedLoadNyuRyokinName =
                    LoadNyuRyokinNameList.SingleOrDefault(s => s.RyokinCd == loadFuttum.SelectedLoadNyuRyokinName.RyokinCd && s.RyokinTikuCd == loadFuttum.SelectedLoadNyuRyokinName.RyokinTikuCd);
            }
            if (loadFuttum.SelectedLoadShuRyokin != null)
            {
                loadFuttum.SelectedLoadShuRyokin =
                    LoadNyuRyokinNameList.SingleOrDefault(s => s.RyokinCd == loadFuttum.SelectedLoadShuRyokin.RyokinCd && s.RyokinTikuCd == loadFuttum.SelectedLoadShuRyokin.RyokinTikuCd);
            }
        }
        if (TaxTypeDataList != null)
        {
            if (loadFuttum.TaxType != null)
            {
                loadFuttum.TaxType =
                    TaxTypeDataList.SingleOrDefault(s => s.IdValue == loadFuttum.TaxType.IdValue);
            }
            if (loadFuttum.SirTaxType != null)
            {
                loadFuttum.SirTaxType =
                    TaxTypeDataList.SingleOrDefault(s => s.IdValue == loadFuttum.SirTaxType.IdValue);
            }
        }
        if (FutaiScheduleList != null && loadFuttum.ScheduleDate != null)
        {
            loadFuttum.ScheduleDate =
                FutaiScheduleList.SingleOrDefault(s => s.Date == loadFuttum.ScheduleDate.Date) ?? loadFuttum.ScheduleDate;
        }
        if (loadFuttum.FuttumKbnMode == IncidentalViewMode.Futai)
        {
            if (LoadFutaiList != null && loadFuttum.SelectedLoadFutai != null)
            {
                loadFuttum.SelectedLoadFutai =
                    LoadFutaiList.SingleOrDefault(s => s.FutaiCdSeq == loadFuttum.SelectedLoadFutai.FutaiCdSeq);
            }
        }
        else if (loadFuttum.FuttumKbnMode == IncidentalViewMode.Tsumi)
        {
            if (LoadTsumiList != null && loadFuttum.SelectedLoadTsumi != null)
            {
                loadFuttum.SelectedLoadTsumi =
                    LoadTsumiList.SingleOrDefault(s => s.CodeKbnSeq == loadFuttum.SelectedLoadTsumi.CodeKbnSeq);
            }
        }

    }

    protected List<LoadNyuRyokinName> GetLoadNyuRyokinNameList()
    {
        if (LoadFuttumModel.SelectedLoadNyuDouro is null)
        {
            return LoadNyuRyokinNameList;
        }

        var result = LoadNyuRyokinNameList.Where(n => n.DouroCdSeq == LoadFuttumModel.SelectedLoadNyuDouro.CodeKbnSeq).ToList();
        if (isChangeNyuDouro)
        {
            HandleSelectedLoadNyuRyokinNameChanged(result.FirstOrDefault());
            isChangeNyuDouro = false;
        }
        return result;
    }

    protected List<LoadNyuRyokinName> GetLoadNyuRyokinNameList2()
    {
        if (LoadFuttumModel.SelectedLoadShuDouro is null)
        {
            return LoadNyuRyokinNameList;
        }

        var result = LoadNyuRyokinNameList.Where(n => n.DouroCdSeq == LoadFuttumModel.SelectedLoadShuDouro.CodeKbnSeq).ToList();
        if (isChangeShuDouro)
        {
            HandleSelectedLoadShuRyokinNameChanged(result.FirstOrDefault());
            isChangeShuDouro = false;
        }
        return result;
    }

    #region Handle value change

    protected void HandleSelectedScheduleChanged(ScheduleSelectorModel newValue)
    {
        LoadFuttumModel.ScheduleDate = newValue;
        LoadFuttumModel.SettingQuantityList.Clear();
        foreach (var item in SettingQuantityList)
        {
            if (LoadFuttumModel.ScheduleDate.Date.IsInRange(item.GarageLeaveDate, item.GarageReturnDate))
            {
                var settingQuantity = new SettingQuantity();
                settingQuantity.SimpleCloneProperties(item);
                LoadFuttumModel.SettingQuantityList.Add(settingQuantity);
            }
        }
        StateHasChanged();
    }

    protected void HandleSelectedFutaiCodeChanged(LoadFutai newValue)
    {
        LoadFuttumModel.SelectedLoadFutai = newValue;
        LoadFuttumModel.FutTumNm = newValue.RyakuNm;

        // change tax type
        LoadFuttumModel.TaxType = TaxTypeDataList.SingleOrDefault(t => t.IdValue == newValue.ZeiHyoKbn);
        LoadFuttumModel.SirTaxType = TaxTypeDataList.SingleOrDefault(t => t.IdValue == newValue.ZeiHyoKbn);
        StateHasChanged();
    }

    protected void HandleLoadFuttumModelNmChanged(string newValue)
    {
        LoadFuttumModel.FutTumNm = newValue;
        StateHasChanged();
    }

    protected void HandleSelectedTsumiCodeChanged(LoadTsumi newValue)
    {
        LoadFuttumModel.SelectedLoadTsumi = newValue;
        LoadFuttumModel.FutTumNm = newValue.RyakuNm;

        StateHasChanged();
    }

    protected void HandleSelectedSeisanCdChanged(LoadSeisanCd newValue)
    {
        LoadFuttumModel.SelectedLoadSeisanCd = newValue;
        LoadFuttumModel.SeisanNm = newValue.RyakuNm;

        LoadFuttumModel.SelectedLoadSeisanKbn = LoadSeisanKbnList.SingleOrDefault(s => byte.Parse(s.CodeKbn) == newValue.SeisanKbn);
        StateHasChanged();
    }

    protected void HandleSelectedSeisanNmChanged(string newValue)
    {
        LoadFuttumModel.SeisanNm = newValue;
        StateHasChanged();
    }

    protected void HandleSelectedSeisanKbnChanged(LoadSeisanKbn newValue)
    {
        LoadFuttumModel.SelectedLoadSeisanKbn = newValue;
        StateHasChanged();
    }

    protected void HandleSelectedNoteInputChanged(string newValue)
    {
        LoadFuttumModel.NoteInput = newValue;
        StateHasChanged();
    }

    protected void HandleSelectedLoadNyuDouroChanged(LoadDouro newValue)
    {
        LoadFuttumModel.SelectedLoadNyuDouro = newValue;
        isChangeNyuDouro = true;
        StateHasChanged();
    }

    protected void HandleSelectedLoadNyuRyokinNameChanged(LoadNyuRyokinName newValue)
    {
        LoadFuttumModel.SelectedLoadNyuRyokinName = newValue;
        LoadFuttumModel.IriRyoNm = newValue?.RyakuNm ?? string.Empty;
        StateHasChanged();
    }

    protected void HandleSelectedIriRyoNmChanged(string newValue)
    {
        LoadFuttumModel.IriRyoNm = newValue;
        StateHasChanged();
    }

    protected void HandleSelectedLoadShuDouroChanged(LoadDouro newValue)
    {
        LoadFuttumModel.SelectedLoadShuDouro = newValue;
        isChangeShuDouro = true;
        StateHasChanged();
    }

    protected void HandleSelectedLoadShuRyokinNameChanged(LoadNyuRyokinName newValue)
    {
        LoadFuttumModel.SelectedLoadShuRyokin = newValue;
        LoadFuttumModel.DeRyoNm = newValue?.RyakuNm ?? string.Empty;
        StateHasChanged();
    }

    protected void HandleSelectedDeRyoNmChanged(string newValue)
    {
        LoadFuttumModel.DeRyoNm = newValue;
        StateHasChanged();
    }

    protected void HandleSuryoChanged(string newValue)
    {
        LoadFuttumModel.Suryo = newValue;
        StateHasChanged();
    }

    protected void HandleTankaChanged(string newValue)
    {
        LoadFuttumModel.Tanka = newValue;
        StateHasChanged();
    }

    protected void HandleTaxTypeChanged(TaxTypeList newValue)
    {
        LoadFuttumModel.TaxType = newValue;
        StateHasChanged();
    }

    protected void HandleZeiritSuChanged(string newValue)
    {
        if(LoadFuttumModel.TaxType.IdValue != Constants.NoTax.IdValue)
        {
            LoadFuttumModel.Zeiritsu = newValue;
        }
        StateHasChanged();
    }

    protected void HandleTesuRituChanged(string newValue)
    {
        LoadFuttumModel.TesuRitu = newValue;
        StateHasChanged();
    }

    protected void HandleSirSuryoChanged(string newValue)
    {
        LoadFuttumModel.SirSuryo = newValue;
        StateHasChanged();
    }

    protected void HandleSirTankaChanged(string newValue)
    {
        LoadFuttumModel.SirTanka = newValue;
        StateHasChanged();
    }

    protected void HandleSirTaxTypeChanged(TaxTypeList newValue)
    {
        LoadFuttumModel.SirTaxType = newValue;
        StateHasChanged();
    }

    protected void HandleSirZeiritsuChanged(string newValue)
    {
        if(LoadFuttumModel.SirTaxType.IdValue != Constants.NoTax.IdValue)
        {
            LoadFuttumModel.SirZeiritsu = newValue;
        }
        StateHasChanged();
    }

    protected void HandleSelectedCustomerChanged(LoadCustomerList newValue)
    {
        LoadFuttumModel.SelectedCustomer = newValue;
        StateHasChanged();
    }

    protected void HandleSettingQuantityChanged(string newValue, SettingQuantity settingQuantity)
    {
        settingQuantity.Suryo = newValue;
        StateHasChanged();
    }

    protected void HandleChangeStateSettingQuantity()
    {
        ShowSettingQuantity = !ShowSettingQuantity;
        JSRuntime.InvokeAsync<string>("loadPageScript", "bookingInputPage", "futaiEnterKey");
        JSRuntime.InvokeAsync<string>("loadPageScript", "bookingInputPage", "futaiTabKey");
    }

    #endregion

    protected void HandleAddFuttum()
    {
        if (IsEditMode)
        {
            LoadFuttumOrigin.SimpleCloneProperties(LoadFuttumModel);
        }
        OnSubmit.InvokeAsync(LoadFuttumOrigin.Index);
    }

    protected void HandleCancelFuttum()
    {
        OnCancel.InvokeAsync(LoadFuttumOrigin.Index);
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private CustomHttpClient HttpClient { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppSettingsService AppSettingsService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<Futai> Lang { get; set; }
    }
}
#pragma warning restore 1591
