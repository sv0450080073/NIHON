#pragma checksum "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "79c652d78c9b8caa0b68dd687f7e2ff09e43bc47"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace HassyaAllrightCloud.Pages.Components
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Infrastructure.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Dto;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Constants;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using BlazorContextMenu;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Application.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.IService;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor.Reporting;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 32 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 33 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal;

#line default
#line hidden
#nullable disable
#nullable restore
#line 34 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 35 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 37 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 38 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 39 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components.CommonComponents;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor"
using System.Threading;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor"
using HassyaAllrightCloud.Commons.Extensions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor"
using HassyaAllrightCloud.Pages.Components.BookingTabs;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor"
using HassyaAllrightCloud.Pages.Components.Popup;

#line default
#line hidden
#nullable disable
    public partial class BookingInputTab : OwningComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 828 "E:\Project\HassyaAllrightCloud\Pages\Components\BookingInputTab.razor"
       
    IncidentalViewMode IncidentalView { get; set; }
    bool PopupFuttumDetail { get; set; } = false;
    bool PopupJourney { get; set; } = false;
    bool PopupTehai { get; set; }
    [CascadingParameter] string id { get; set; }
    [CascadingParameter] bool IsCopyMode { get; set; }
    [CascadingParameter] public CallBackTabBookingState CallBackIndexCommand { get; set; }
    [CascadingParameter] public EditContext formContext { get; set; }
    [Parameter] public EventCallback<CallBackTabBookingState> OnChangeCommandState { get; set; }
    [Parameter] public BookingFormData BookingData { get; set; }
    [Parameter] public EventCallback<List<FileInfoData>> UpdateFileupload { get; set; }
    int activeTabIndex = 0;
    int waitingTabIndex = -1;
    private readonly string patternFaxTel = @"[^0-9-]+";
    private readonly int[] tabIndexNotSave = {0,1,2,3,9};
    private readonly int[] tabIndexNotModify = {4,5,6};
    [Parameter] public bool TenantHasCustomData { get; set; }
    public int ActiveTabIndex
    {
        get
        {
            return activeTabIndex;
        }
        set
        {
            // create mode
            if(string.IsNullOrWhiteSpace(id))
            {
                activeTabIndex = value;
            }
            else
            {
                if (tabIndexNotModify.Contains(activeTabIndex))
                {
                    formContext.MarkAsUnmodified();
                }
                // switch between [0,1,2,3,9] not need to save data
                if (tabIndexNotSave.Contains(activeTabIndex) && tabIndexNotSave.Contains(value))
                {
                    activeTabIndex = value;
                }
                else if (isValidBookingForm)
                {
                    if (formContext.IsModified()&& IsCopyMode==false)
                    {
                        isPopupAskSaveBooking = true;
                        waitingTabIndex = value;
                    }
                    else
                    {
                        CallBackTabBookingState cbAction;
                        activeTabIndex = value;
                        if (tabIndexNotSave.Contains(value))
                        {
                            cbAction = CallBackTabBookingState.EnableIndex;
                        }
                        else
                        {
                            cbAction = CallBackTabBookingState.DisableIndex;
                        }
                        OnChangeCommandState.InvokeAsync(cbAction);
                    }
                }
            }
            StateHasChanged();
        }
    }
    string baseUrl = string.Empty;
    public ConfirmStatus confirmStatus;
    public bool isConfirmSuccess = false;
    public bool isPopupAskSaveBooking = false;
    public bool isEnableSubmitConfirm = false;
    public bool isEnableSubmitCancel = false;
    public int maxRowTab7 = 15;
    public string tempstr;
    public object tempObject;

    bool Value { get; set; }
    DateTime DateTimeValue = DateTime.Today;

    CultureInfo ci = new CultureInfo("ja-JP");
    string popupTitleInfo;
    string popupTitleError;
    string popupTitleWarning;
    string yes;
    string no;
    string ok;
    string bookingFixedSuccess;
    string bookingUnFixedSuccess;
    string commonError;
    string configurationButtonText;
    string updateButtonText;
    string popupTitle;
    string popupContent;
    string TabUpload;
    private string updateResultSuccessMessage;
    private string updateResultErrorMessage;

    List<SupplierData> supplierDataList;
    List<DestinationData> destinationDataList;
    List<PlaceData> placeDataList;
    List<TPM_CodeKbCodeSyuData> movementStatusList;
    List<TPM_CodeKbCodeSyuData> acceptanceConditionList;
    List<TPM_CodeKbCodeSyuData> rainyMeasureList;
    List<TPM_CodeKbCodeSyuData> paymentMethodList;
    List<TPM_CodeKbCodeSyuData> movementFormList;
    List<TPM_CodeKbCodeSyuData> guiderSettingList;
    List<TPM_CodeKbCodeSyuData> estimateSettingList;
    List<SettingStaff> settingStaffList;
    List<ArrangementType> arrangementTypeList;
    List<ArrangementCar> carArrangementList;
    ArrangementCar selectedCarArrangement;
    Dictionary<string, string> LangDic = new Dictionary<string, string>();

    //List<LoadCodeKb> loadCodeKbList;
    //List<LoadFutai> loadFutaiList;
    //List<LoadNoteMaster> loadNoteMasterList;
    //List<LoadNyuRyokinName> loadNyuRyokinNameList;
    //List<LoadSeisanCd> loadSeisanCdList;
    List<LoadSeisanKbn> loadSeisanKbnList;

    List<JourneysData> carListData;
    JourneysData selectedCar;
    List<JourneyNoteView> noteViewList = new List<JourneyNoteView>();
    SijJoKnmData SijJoKnmData { get; set; }
    protected MyPopupModel MyPopup { get; set; }
    public HassyaAllrightCloud.Pages.Components.CommonComponents.CustomerComponent CustomerComponent { get; set; }
    = new HassyaAllrightCloud.Pages.Components.CommonComponents.CustomerComponent();

    private void LocalizationInit()
    {
        popupTitleError = Lang["PopupTitleError"];
        popupTitleInfo = Lang["PopupTitleInfo"];
        popupTitleWarning = Lang["PopupTitleWarning"];
        yes = Lang["Yes"];
        no = Lang["No"];
        ok = Lang["OK"];
        configurationButtonText = Lang["ConfigurationButton"];
        updateButtonText = Lang["UpdateButton"];
        bookingFixedSuccess = Lang["BookingFixed"];
        bookingUnFixedSuccess = Lang["BookingUnFixed"];
        commonError = Lang["CommonError"];
        var dataLang = Lang.GetAllStrings();
        LangDic = dataLang.ToDictionary(l => l.Name, l => l.Value);
        TabUpload = Lang["TabUpload"];
        updateResultSuccessMessage = Lang["UpdateResultSuccessMessage"];
        updateResultErrorMessage = Lang["UpdateResultErrorMessage"];
    }

    protected override async Task OnInitializedAsync()
    {
        LocalizationInit();
        MyPopup = new MyPopupModel();
        baseUrl = AppSettingsService.GetBaseUrl();
        SijJoKnmData = BusBookingDataService.GetSijJoKnm("001", new ClaimModel().TenantID);
        await LoadAllDataCombobox();

        //create mode
        if (id == "0" || id == null)
        {
            SetDefaultValueReservationTab(BookingData);
        }
        // edit mode
        else
        {
            if (BookingData.BookingStatus.CodeKbn == Constants.BookingStatus)
            {
                await SetupJourneyTabAsync();
                await SetupIncidentalTabAsync(BookingData);
                await SetupArrangementTab(BookingData);
                //SetupCOnfirmationTab(BookingData);
            }
            //await SetupCancelTabAsync(BookingData); // moved to tab
            //await SetupJourneyTabAsync();
            //await SetupIncidentalTabAsync(BookingData);
            //await SetupArrangementTab(BookingData);
            //SetupCOnfirmationTab(BookingData);

            await Load(BookingData);
        }
    }

    public async Task Load(BookingFormData booking)
    {
        IncidentalView = IncidentalViewMode.Futai;
        //if (supplierDataList != null)
        //{
        //    if (booking.SupervisorTabData.customerComponentTokiStData != null)
        //    {
        //        int sirCdSeq = booking.SupervisorTabData.customerComponentTokiStData.TokuiSeq;
        //        int sirSitenCdSeq = booking.SupervisorTabData.customerComponentTokiStData.SitenCdSeq;
        //        var supplier = supplierDataList.SingleOrDefault(s => s.SirCdSeq == sirCdSeq && s.SirSitenCdSeq == sirSitenCdSeq);
        //        if (supplier != null) booking.SupervisorTabData.customerComponentTokiStData = new Domain.Dto.CommonComponents.CustomerComponentTokiStData() {
        //            RyakuNm = supplier.RyakuNm,
        //            SitenCd = (short)supplier.SitenCd,
        //            SitenCdSeq = supplier.SirCdSeq,
        //            TokuiSeq = supplier.SirSitenCdSeq
        //        };
        //    }
        //}
        //------------
        if (booking.ReservationTabData.Destination != null && destinationDataList != null)
        {
            int basyoMapCdSeq = booking.ReservationTabData.Destination.BasyoMapCdSeq;
            booking.ReservationTabData.Destination = destinationDataList.FirstOrDefault(d => d.BasyoMapCdSeq == basyoMapCdSeq);
        }
        if (booking.ReservationTabData.DespatchingPlace != null && placeDataList != null)
        {
            int haiSCdSeq = booking.ReservationTabData.DespatchingPlace.HaiSCdSeq;
            booking.ReservationTabData.DespatchingPlace = placeDataList.FirstOrDefault(d => d.HaiSCdSeq == haiSCdSeq);
        }
        if (booking.ReservationTabData.ArrivePlace != null && placeDataList != null)
        {
            int haiSCdSeq = booking.ReservationTabData.ArrivePlace.HaiSCdSeq;
            booking.ReservationTabData.ArrivePlace = placeDataList.FirstOrDefault(d => d.HaiSCdSeq == haiSCdSeq);
        }
        // data in Unkobi is tinyInt but in CodeSyu is nvarchar => 1 != 01 => convert to byte
        if (booking.ReservationTabData.MovementStatus != null && movementStatusList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.MovementStatus.CodeKbn);
            booking.ReservationTabData.MovementStatus = movementStatusList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        if (booking.ReservationTabData.AcceptanceConditions != null && acceptanceConditionList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.AcceptanceConditions.CodeKbn);
            booking.ReservationTabData.AcceptanceConditions = acceptanceConditionList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        if (booking.ReservationTabData.RainyMeasure != null && rainyMeasureList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.RainyMeasure.CodeKbn);
            booking.ReservationTabData.RainyMeasure = rainyMeasureList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        if (booking.ReservationTabData.PaymentMethod != null && paymentMethodList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.PaymentMethod.CodeKbn);
            booking.ReservationTabData.PaymentMethod = paymentMethodList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        if (booking.ReservationTabData.MovementForm != null && movementFormList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.MovementForm.CodeKbn);
            booking.ReservationTabData.MovementForm = movementFormList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        if (booking.ReservationTabData.GuiderSetting != null && guiderSettingList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.GuiderSetting.CodeKbn);
            booking.ReservationTabData.GuiderSetting = guiderSettingList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        if (booking.ReservationTabData.EstimateSetting != null && estimateSettingList != null)
        {
            byte codeKbn = Byte.Parse(booking.ReservationTabData.EstimateSetting.CodeKbn);
            booking.ReservationTabData.EstimateSetting = estimateSettingList.FirstOrDefault(d => Byte.Parse(d.CodeKbn) == codeKbn);
        }
        //LoadCancelComboboxValue(booking);
        LoadArrangementComboboxValue(booking);
        LoadIncidentalComboboxValue(booking.FuttumViewList);
        await InvokeAsync(StateHasChanged);
    }

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
    }

    public async Task LoadAllDataCombobox()
    {
        supplierDataList = await Http.GetJsonAsync<List<SupplierData>>(baseUrl + "/api/BookingInput/Supervisor/Supplier");
        destinationDataList = await Http.GetJsonAsync<List<DestinationData>>(baseUrl + "/api/BookingInput/Reservation/Destination");
        placeDataList = await Http.GetJsonAsync<List<PlaceData>>(baseUrl + "/api/BookingInput/Reservation/Place");
        movementStatusList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/UNKOJKBN");
        acceptanceConditionList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/UKEJYKBNCD");
        rainyMeasureList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/SIJJOKBN1");
        paymentMethodList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/SIJJOKBN2");
        movementFormList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/SIJJOKBN3");
        guiderSettingList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/SIJJOKBN4");
        estimateSettingList = await Http.GetJsonAsync<List<TPM_CodeKbCodeSyuData>>(baseUrl + "/api/BookingInput/Reservation/GetCodeKbnByCodeSyu/SIJJOKBN5");
    }

    public void SetSelectedSupplier(int sirCdSeq, int sirSitenCdSeq)
    {
        if (supplierDataList == null)
            return;
        var supplier = supplierDataList.SingleOrDefault(s => s.SirCdSeq == sirCdSeq && s.SirSitenCdSeq == sirSitenCdSeq);
        if (supplier == null)
        {
            StateHasChanged();
            return;
        }
        CustomerComponent.DefaultTokisk = supplier.SirCdSeq;
        CustomerComponent.DefaultTokiSt = supplier.SirSitenCdSeq;
        CustomerComponent.DefaultGyosya = null;
        CustomerComponent.RenderByTokiskTokist();
        //formContext.NotifyFieldChanged(FieldIdentifier.Create(() => BookingData.SupervisorTabData.customerComponentTokiStData));
        InvokeAsync(StateHasChanged);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        JSRuntime.InvokeVoidAsync("setEventforTimeInput");
        JSRuntime.InvokeVoidAsync("setEventForTelAndFaxInput");
        JSRuntime.InvokeAsync<string>("addMaxLength", "length", 50);
        JSRuntime.InvokeAsync<string>("addMaxLength", "length", 3);
        JSRuntime.InvokeAsync<string>("addMaxLength", "length", 8);
        JSRuntime.InvokeAsync<string>("addMaxLength", "length", 4);
        JSRuntime.InvokeVoidAsync("zoomTabBooking");
        JSRuntime.InvokeAsync<string>("addtabindex", "notabindex");

        if (firstRender == false)
        {
            if (formContext.IsModified())
            {
                if (!isEnableSubmitCancel)
                {
                    isEnableSubmitCancel = true;
                    StateHasChanged();
                }
                if (!isEnableSubmitConfirm)
                {
                    isEnableSubmitConfirm = true;
                    StateHasChanged();
                }
            }
        }
    }

    #region Booking Tab Supervisor value changed methods

    protected void OnKanJNmChanged(string newValue)
    {
        BookingData.SupervisorTabData.KanJNm = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanjTelChanged(string newValue)
    {
        var newValueNor = newValue.Normalize(System.Text.NormalizationForm.FormKC);

        if(!Regex.IsMatch(newValueNor, patternFaxTel))
        {
            BookingData.SupervisorTabData.KanjTel = newValueNor;
        }

        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanjFaxChanged(string newValue)
    {
        var newValueNor = newValue.Normalize(System.Text.NormalizationForm.FormKC);

        if(!Regex.IsMatch(newValueNor, patternFaxTel))
        {
            BookingData.SupervisorTabData.KanjFax = newValueNor;
        }

        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanjJyus1Changed(string newValue)
    {
        BookingData.SupervisorTabData.KanjJyus1 = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanjJyus2Changed(string newValue)
    {
        BookingData.SupervisorTabData.KanjJyus2 = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanjKeiNoChanged(string newValue)
    {
        BookingData.SupervisorTabData.KanjKeiNo = newValue.Normalize(System.Text.NormalizationForm.FormKC);
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanjMailChanged(string newValue)
    {
        BookingData.SupervisorTabData.KanjMail = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnKanDMHFlgChanged(bool newValue)
    {
        BookingData.SupervisorTabData.KanDMHFlg = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnPlusJinChanged(string newValue)
    {
        if (string.IsNullOrWhiteSpace(newValue) == false)
        {
            if (int.TryParse(newValue.Normalize(System.Text.NormalizationForm.FormKC), out int newValueInt) && newValueInt >= 0 && newValueInt <= 9999)
            {
                BookingData.SupervisorTabData.PlusJin = newValueInt.ToString();
            }
        }
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnTokuiTanNmChanged(string newValue)
    {
        BookingData.SupervisorTabData.TokuiTanNm = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnTokuiTelChanged(string newValue)
    {
        var newValueNor = newValue.Normalize(System.Text.NormalizationForm.FormKC);

        if(!Regex.IsMatch(newValueNor, patternFaxTel))
        {
            BookingData.SupervisorTabData.TokuiTel = newValueNor;
        }

        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnTokuiFaxChanged(string newValue)
    {
        var newValueNor = newValue.Normalize(System.Text.NormalizationForm.FormKC);

        if(!Regex.IsMatch(newValueNor, patternFaxTel))
        {
            BookingData.SupervisorTabData.TokuiFax = newValueNor;
        }

        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnTokuiMailChanged(string newValue)
    {
        BookingData.SupervisorTabData.TokuiMail = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnJyoSyaJinChanged(string newValue)
    {
        if (string.IsNullOrWhiteSpace(newValue) == false)
        {
            if (int.TryParse(newValue.Normalize(System.Text.NormalizationForm.FormKC), out int newValueInt) && newValueInt >= 0 && newValueInt <= 9999)
            {
                BookingData.SupervisorTabData.JyoSyaJin = newValueInt.ToString();
            }
        }
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void SelectedSupplierChanged(string propertyName, dynamic value)
    {
        var propertyInfo = BookingData.SupervisorTabData.GetType().GetProperty(propertyName);
        propertyInfo.SetValue(BookingData.SupervisorTabData, value, null);
        //BookingDataChanged.InvokeAsync(BookingData);
        CallBackIndexCommand = value == null ? CallBackIndexCommand : CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected async Task<IEnumerable<SupplierData>> GetSupplierListAsync(CancellationToken ct = default)
    {
        supplierDataList = await Http.GetJsonAsync<List<SupplierData>>(baseUrl + "/api/BookingInput/Supervisor/Supplier");
        if (id != "0" && id != null)
        {
            if (BookingData.SupervisorTabData.customerComponentTokiStData != null && supplierDataList != null)
            {
                int sirCdSeq = BookingData.SupervisorTabData.customerComponentTokiStData.TokuiSeq;
                int sirSitenCdSeq = BookingData.SupervisorTabData.customerComponentTokiStData.SitenCdSeq;
                var supplier = supplierDataList.SingleOrDefault(s => s.SirCdSeq == sirCdSeq && s.SirSitenCdSeq == sirSitenCdSeq);
                if (supplier != null) BookingData.SupervisorTabData.customerComponentTokiStData = new Domain.Dto.CommonComponents.CustomerComponentTokiStData()
                {
                    RyakuNm = supplier.RyakuNm,
                    SitenCd = (short)supplier.SitenCd,
                    SitenCdSeq = supplier.SirCdSeq,
                    TokuiSeq = supplier.SirSitenCdSeq
                };
                await InvokeAsync(StateHasChanged);
            }
        }
        return supplierDataList;
    }

    #endregion

    #region Booking tab Reservation value changed methods

    protected void OnGarageLeaveDateChanged(DateTime newDate)
    {
        CallBackIndexCommand = CallBackTabBookingState.False;
        BookingData.ReservationTabData.GarageLeaveDate = newDate;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnGoDateDateChanged(DateTime newDate)
    {
        CallBackIndexCommand = CallBackTabBookingState.False;
        BookingData.ReservationTabData.GoDate = newDate;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void OnGarageReturnDateDateChanged(DateTime newDate)
    {
        CallBackIndexCommand = CallBackTabBookingState.False;
        BookingData.ReservationTabData.GarageReturnDate = newDate;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void GarageLeaveTimeChanged(object newTime)
    {
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void DepartureStartTimeChanged(string newTime)
    {
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void GarageReturnTimeChanged(string newTime)
    {
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void SelectedDestinationChanged(DestinationData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.Destination = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            BookingData.ReservationTabData.IkNm = BookingData.ReservationTabData.Destination.VpmBasyoRyakuNm;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void DestinationNameChanged(string newName)
    {
        BookingData.ReservationTabData.IkNm = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void SelectedDespatchingPlaceChanged(PlaceData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.DespatchingPlace = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            BookingData.ReservationTabData.HaiSNm = BookingData.ReservationTabData.DespatchingPlace.VpmHaichiRyakuNm;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void DespatchingPlaceNameChanged(string newName)
    {
        BookingData.ReservationTabData.HaiSNm = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void HaiSjyus1Changed(string newName)
    {
        BookingData.ReservationTabData.HaiSjyus1 = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void HaiSjyus2Changed(string newName)
    {
        BookingData.ReservationTabData.HaiSjyus2 = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void SelectedArrivePlaceChanged(PlaceData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.ArrivePlace = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            BookingData.ReservationTabData.TouNm = BookingData.ReservationTabData.ArrivePlace.VpmHaichiRyakuNm;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void ArrivePlaceNameChanged(string newName)
    {
        BookingData.ReservationTabData.TouNm = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void TouJyusyo1Changed(string newName)
    {
        BookingData.ReservationTabData.TouJyusyo1 = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void TouJyusyo2Changed(string newName)
    {
        BookingData.ReservationTabData.TouJyusyo2 = newName;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    protected void SelectedMovementStatusChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null && BookingData.IsDailyReportRegisted == false)
        {
            BookingData.ReservationTabData.MovementStatus = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void SelectedAcceptanceConditionsChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.AcceptanceConditions = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void SelectedRainyMeasureChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.RainyMeasure = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void SelectedPaymentMethodChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.PaymentMethod = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void SelectedMovementFormChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.MovementForm = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void SelectedGuiderSettingChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.GuiderSetting = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    protected void SelectedEstimateSettingChanged(TPM_CodeKbCodeSyuData newData)
    {
        if (newData != null)
        {
            BookingData.ReservationTabData.EstimateSetting = newData;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    #endregion

    #region Booking Tab3

    public void SetDefaultValueReservationTab(BookingFormData data)
    {
        data.SupervisorTabData.customerComponentGyosyaData = data.customerComponentGyosyaData;
        data.ReservationTabData.MovementStatus = movementStatusList.FirstOrDefault(m => m.CodeKbn == "5");
        data.ReservationTabData.AcceptanceConditions = acceptanceConditionList.FirstOrDefault(m => m.CodeKbn == "99");
        data.ReservationTabData.RainyMeasure = rainyMeasureList.FirstOrDefault(m => m.CodeKbn == "99");
        data.ReservationTabData.PaymentMethod = paymentMethodList.FirstOrDefault(m => m.CodeKbn == "99");
        data.ReservationTabData.MovementForm = movementFormList.FirstOrDefault(m => m.CodeKbn == "99");
        data.ReservationTabData.GuiderSetting = guiderSettingList.FirstOrDefault(m => m.CodeKbn == "99");
        data.ReservationTabData.EstimateSetting = estimateSettingList.FirstOrDefault(m => m.CodeKbn == "99");

        data.ReservationTabData.SyuKoTime.Str = data.BusStartTime.Str;
        data.ReservationTabData.SyuPatime.Str = data.BusStartTime.Str;
        data.ReservationTabData.KikTime.Str = data.BusEndTime.Str;

        data.ReservationTabData.GarageLeaveDate = data.BusStartDate;
        data.ReservationTabData.GarageReturnDate = data.BusEndDate;
    }

    protected void BikoNmChanged(string newValue)
    {
        BookingData.BikoNm = newValue;
        CallBackIndexCommand = CallBackTabBookingState.False;
        OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
    }

    public void OnPreDayChecked(bool isChecked)
    {
        if (isChecked)
        {
            BookingData.ReservationTabData.GarageLeaveDate = BookingData.ReservationTabData.GarageLeaveDate.AddDays(-1);
        }
        else
        {
            BookingData.ReservationTabData.GarageLeaveDate = BookingData.BusStartDate;
        }
        StateHasChanged();
    }

    public void OnAfterDayChecked(bool isChecked)
    {
        if (isChecked)
        {
            BookingData.ReservationTabData.GarageReturnDate = BookingData.ReservationTabData.GarageReturnDate.AddDays(1);
        }
        else
        {
            BookingData.ReservationTabData.GarageReturnDate = BookingData.BusEndDate;
        }
        StateHasChanged();
    }

    #endregion

    #region Booking Tab7

    protected void OnConfirmChange()
    {
        OnChangeCommandState.InvokeAsync(CallBackTabBookingState.True);
    }

    protected async Task HandleConfirmTabConfirmSuccess((ConfirmStatus status, bool success) confirm)
    {
        if(confirm.success)
        {
            if (confirm.status == ConfirmStatus.Fixed)
            {
                MyPopup.Build()
                        .WithTitle(popupTitleInfo)
                        .WithBody(bookingFixedSuccess)
                        .WithIcon(MyPopupIconType.Info)
                        .AddButton(new MyPopupFooterButton(ok, () => MyPopup.Hide()))
                        .Show();
            }
            else
            {
                MyPopup.Build()
                        .WithTitle(popupTitleInfo)
                        .WithBody(bookingUnFixedSuccess)
                        .WithIcon(MyPopupIconType.Info)
                        .AddButton(new MyPopupFooterButton(ok, () => MyPopup.Hide()))
                        .Show();
            }
            await OnChangeCommandState.InvokeAsync(CallBackTabBookingState.FixedConfirm);
        }
        else
        {
            MyPopup.Build()
                    .WithTitle(popupTitleError)
                    .WithBody(commonError)
                    .WithIcon(MyPopupIconType.Info)
                    .AddButton(new MyPopupFooterButton(ok, () => MyPopup.Hide()))
                    .Show();
        }
    }

    #endregion

    #region BookingInput tab 5

    public async Task SetupJourneyTabAsync()
    {
        noteViewList.Clear();
        bool isZenHaFlg = false;
        bool isKhakFlg = false;
        carListData = await BusBookingDataService.GetJourneysData(id,BookingData.UnkRen);
        carListData.Insert(0, new JourneysData());
        selectedCar = carListData.First();
        carListData.First().Unkobi_TouChTime = BookingData.BusEndTime.ToStringWithoutDelimiter();
        carListData.First().Unkobi_SyuPaTime = BookingData.ReservationTabData.SyuPatime.ToStringWithoutDelimiter();
        var fromdatemin = BookingData.BusStartDate;
        var fromdate = BookingData.BusStartDate;
        var todate = BookingData.BusEndDate;
        var todatemax = BookingData.BusEndDate;
        string ukeno = BookingData.UkeNo;
        short unkRen = 1;// TODO get from BookingInput

        if (carListData.Count > 1)
        {
            carListData.First().Unkobi_TouChTime = carListData.Skip(1).Take(1).First().Unkobi_TouChTime;
            carListData.First().Unkobi_SyuPaTime = carListData.Skip(1).Take(1).First().Unkobi_SyuPaTime;
            fromdatemin = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Unkobi_HaiSYmd, "yyyyMMdd", null);
            fromdate = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Haisha_HaiSYmd, "yyyyMMdd", null);
            todate = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Haisha_TouYmd, "yyyyMMdd", null);
            todatemax = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Unkobi_TouYmd, "yyyyMMdd", null);
            if (carListData.Skip(1).Take(1).First().Unkobi_ZenHaFlg == 1)
            {
                isZenHaFlg = true;
            }
            if (carListData.Skip(1).Take(1).First().Unkobi_KhakFlg == 1)
            {
                isKhakFlg = true;
            }
            ukeno = carListData.Skip(1).Take(1).First().Haisha_UkeNo;
            unkRen = carListData.Skip(1).Take(1).First().Haisha_UnkRen;
        }
        var dateList = GetDateData(fromdate, todate, fromdatemin, todatemax, true, isZenHaFlg, isKhakFlg, ukeno,
                    carListData.First().Haisha_BunkRen, carListData.First().Haisha_TeiDanNo, unkRen, carListData.First());

        foreach (var dateItem in dateList)
        {
            var journeyNote = new JourneyNoteView() { DateView = dateItem.Text };
            List<TKD_KoteiData> noteList = await TKD_KoteiDataService.GetDataKotei(dateItem.isCommom, ukeno, dateItem.isZenHaFlg, dateItem.isKhakFlg,
                                                            dateItem.teiDanNo, unkRen, dateItem.bunkRen, dateItem.nittei);
            foreach (var items in noteList.OrderBy(e => e.Kotei_TeiDanNo).ThenBy(e => e.Kotei_KouRen))
            {
                journeyNote.NoteViewList.Add(items.Kotei_Koutei);
            }
            if (noteList.Count == 0)
            {
                journeyNote.NoteViewList.Add(string.Empty);
            }
            noteViewList.Add(journeyNote);
        }
    }

    protected async Task CarItemChanged(JourneysData newValue)
    {
        if (newValue != null)
        {
            noteViewList.Clear();
            selectedCar = newValue;
            bool isCommon = selectedCar.Haisha_GoSya == null;
            bool isZenHaFlg, isKhakFlg;
            DateTime fromdatemin, fromdate, todate, todatemax;
            string ukeno;
            short unkRen;
            if (isCommon)
            {
                isZenHaFlg = false;
                isKhakFlg = false;
                fromdatemin = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Unkobi_HaiSYmd, "yyyyMMdd", null);
                fromdate = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Unkobi_HaiSYmd, "yyyyMMdd", null);
                todate = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Unkobi_TouYmd, "yyyyMMdd", null);
                todatemax = DateTime.ParseExact(carListData.Skip(1).Take(1).First().Unkobi_TouYmd, "yyyyMMdd", null);
                if (carListData.Skip(1).Take(1).First().Unkobi_ZenHaFlg == 1)
                {
                    isZenHaFlg = true;
                }
                if (carListData.Skip(1).Take(1).First().Unkobi_KhakFlg == 1)
                {
                    isKhakFlg = true;
                }
                ukeno = carListData.Skip(1).Take(1).First().Haisha_UkeNo;
                unkRen = carListData.Skip(1).Take(1).First().Haisha_UnkRen;
            }
            else
            {
                isZenHaFlg = false;
                isKhakFlg = false;
                fromdatemin = DateTime.ParseExact(selectedCar.Unkobi_HaiSYmd, "yyyyMMdd", null);
                fromdate = DateTime.ParseExact(selectedCar.Haisha_HaiSYmd, "yyyyMMdd", null);
                todate = DateTime.ParseExact(selectedCar.Haisha_TouYmd, "yyyyMMdd", null);
                todatemax = DateTime.ParseExact(selectedCar.Unkobi_TouYmd, "yyyyMMdd", null);
                if (selectedCar.Unkobi_ZenHaFlg == 1)
                {
                    isZenHaFlg = true;
                }
                if (selectedCar.Unkobi_KhakFlg == 1)
                {
                    isKhakFlg = true;
                }
                ukeno = selectedCar.Haisha_UkeNo;
                unkRen = selectedCar.Haisha_UnkRen;
            }
            var dateList = GetDateData(fromdate, todate, fromdatemin, todatemax, isCommon, isZenHaFlg, isKhakFlg, ukeno,
                        selectedCar.Haisha_BunkRen, selectedCar.Haisha_TeiDanNo, unkRen, selectedCar);

            foreach (var dateItem in dateList)
            {
                var journeyNote = new JourneyNoteView() { DateView = dateItem.Text };
                List<TKD_KoteiData> noteList = await TKD_KoteiDataService.GetDataKotei(dateItem.isCommom, ukeno, dateItem.isZenHaFlg, dateItem.isKhakFlg,
                                                                dateItem.teiDanNo, unkRen, dateItem.bunkRen, dateItem.nittei);
                foreach (var items in noteList.OrderBy(e => e.Kotei_TeiDanNo).ThenBy(e => e.Kotei_KouRen))
                {
                    journeyNote.NoteViewList.Add(items.Kotei_Koutei);
                }
                if (noteList.Count == 0)
                {
                    journeyNote.NoteViewList.Add(string.Empty);
                }
                noteViewList.Add(journeyNote);
            }
            StateHasChanged();
        }
    }

    public List<JourneyDataDate> GetDateData(DateTime fromdate, DateTime todate, DateTime fromdatemin, DateTime todatemax, bool isCommom,
        bool isZenHaFlg, bool isKhakFlg, string ukeno, short bunkRen, short teiDanNo, short unkRen, JourneysData journeyitem)
    {
        List<JourneyDataDate> dateList = new List<JourneyDataDate>();
        int i = 0;
        for (DateTime date = fromdate; date <= todate; date = date.AddDays(1))
        {
            JourneyDataDate itemdate = new JourneyDataDate();
            itemdate.isKhakFlg = isKhakFlg;
            if (isKhakFlg == true)
            {
                itemdate.isKhakFlg = !isKhakFlg;
            }
            itemdate.isZenHaFlg = isZenHaFlg;
            if (isZenHaFlg == true)
            {
                itemdate.isZenHaFlg = !isZenHaFlg;
            }
            itemdate.tomKbn = 1;
            i++;
            itemdate.nittei = (byte)i;
            if (!isCommom)
            {
                itemdate.isCommom = isCommom;
            }
            itemdate.date = date;
            itemdate.ukeNo = ukeno;
            itemdate.bunkRen = bunkRen;
            itemdate.unkRen = unkRen;
            itemdate.teiDanNo = teiDanNo;
            //itemdate.form = BusScheduleHelper.ConvertTime("0000");
            //itemdate.to = BusScheduleHelper.ConvertTime("2359");
            dateList.Add(itemdate);

        }
        if (isCommom == true)
        {
            if (isZenHaFlg && fromdate == fromdatemin)
            {
                JourneyDataDate itemdate = new JourneyDataDate();
                itemdate.isKhakFlg = !isKhakFlg;
                itemdate.isZenHaFlg = isZenHaFlg;
                itemdate.nittei = 1;
                itemdate.tomKbn = 2;
                if (!isCommom)
                {
                    itemdate.isCommom = isCommom;
                }
                itemdate.date = fromdate.AddDays(-1);
                itemdate.ukeNo = ukeno;
                itemdate.bunkRen = bunkRen;
                itemdate.unkRen = unkRen;
                itemdate.teiDanNo = teiDanNo;
                //itemdate.form = BusScheduleHelper.ConvertTime("0000");
                //itemdate.to = BusScheduleHelper.ConvertTime("2359");
                dateList.Add(itemdate);
            }
            if (isKhakFlg && todate == todatemax)
            {
                JourneyDataDate itemdate = new JourneyDataDate();
                itemdate.isZenHaFlg = !isZenHaFlg;
                itemdate.isKhakFlg = isKhakFlg;
                itemdate.nittei = 1;
                itemdate.tomKbn = 3;
                if (!isCommom)
                {
                    itemdate.isCommom = isCommom;
                }
                itemdate.date = todate.AddDays(1);
                itemdate.ukeNo = ukeno;
                itemdate.bunkRen = bunkRen;
                itemdate.unkRen = unkRen;
                itemdate.teiDanNo = teiDanNo;
                //itemdate.form = BusScheduleHelper.ConvertTime("0000");
                //itemdate.to = BusScheduleHelper.ConvertTime("2359");
                dateList.Add(itemdate);
            }
        }
        else
        {
            if (isZenHaFlg)
            {
                JourneyDataDate itemdate = new JourneyDataDate();
                itemdate.isKhakFlg = !isKhakFlg;
                itemdate.isZenHaFlg = isZenHaFlg;
                itemdate.nittei = 1;
                itemdate.tomKbn = 2;
                if (!isCommom)
                {
                    itemdate.isCommom = isCommom;
                }
                itemdate.date = fromdate.AddDays(-1);
                itemdate.ukeNo = ukeno;
                itemdate.bunkRen = bunkRen;
                itemdate.unkRen = unkRen;
                itemdate.teiDanNo = teiDanNo;
                //itemdate.form = BusScheduleHelper.ConvertTime("0000");
                //itemdate.to = BusScheduleHelper.ConvertTime("2359");
                dateList.Add(itemdate);
            }
            if (isKhakFlg)
            {
                JourneyDataDate itemdate = new JourneyDataDate();
                itemdate.isZenHaFlg = !isZenHaFlg;
                itemdate.isKhakFlg = isKhakFlg;
                itemdate.nittei = 1;
                itemdate.tomKbn = 3;
                if (!isCommom)
                {
                    itemdate.isCommom = isCommom;
                }
                itemdate.date = todate.AddDays(1);
                itemdate.ukeNo = ukeno;
                itemdate.bunkRen = bunkRen;
                itemdate.unkRen = unkRen;
                itemdate.teiDanNo = teiDanNo;
                //itemdate.form = BusScheduleHelper.ConvertTime("0000");
                //itemdate.to = BusScheduleHelper.ConvertTime("2359");
                dateList.Add(itemdate);
            }
        }
        if (isCommom)
        {
            dateList.OrderBy(t => t.date).First().form = BusScheduleHelper.ConvertTime(journeyitem.Unkobi_SyuPaTime);
            dateList.OrderBy(t => t.date).Last().to = BusScheduleHelper.ConvertTime(journeyitem.Unkobi_TouChTime);
        }
        else
        {
            dateList.OrderBy(t => t.date).First().form = BusScheduleHelper.ConvertTime(journeyitem.Haisha_SyuPaTime);
            dateList.OrderBy(t => t.date).Last().to = BusScheduleHelper.ConvertTime(journeyitem.Haisha_TouChTime);
        }
        return dateList.OrderBy(t => t.date).ToList();
    }

    public void OpenJourneys()
    {
        if(!IsCopyMode)
        {
            PopupJourney = true;
        }
        StateHasChanged();
    }

    public void OpenTehai()
    {
        if(!IsCopyMode)
        {
            PopupTehai = true;
        }

        StateHasChanged();
    }

    #endregion

    #region BookingInput tab 4

    protected void SelectedPassengerTypeChanged(PassengerType newValue)
    {
        if (newValue != null)
        {
            BookingData.PassengerTypeData = newValue;
            CallBackIndexCommand = CallBackTabBookingState.False;
            OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
        }
    }

    #endregion

    #region Booking Input Tab 8 Cancel

    protected void OnCancelChange()
    {
        OnChangeCommandState.InvokeAsync(CallBackTabBookingState.True);
    }

    #endregion

    #region incidental tab

    public async Task SetupIncidentalTabAsync(BookingFormData booking)
    {
        loadSeisanKbnList = await Http.GetJsonAsync<List<LoadSeisanKbn>>(baseUrl + "/api/BookingIncidental/LoadSeisanKbn");
    }

    public void LoadIncidentalComboboxValue(List<LoadFuttum> futtumList)
    {
        for (int index = 0; index < futtumList.Count; index++)
        {
            var futtumView = futtumList[index];
            futtumView.SelectedLoadSeisanKbn =
                loadSeisanKbnList.FirstOrDefault(s => byte.Parse(s.CodeKbn) == byte.Parse(futtumView.SelectedLoadSeisanKbn.CodeKbn));
        }
    }

    protected void OpenPopupFuttumDetail()
    {
        if(!IsCopyMode)
        {
            PopupFuttumDetail = true;
        }
        StateHasChanged();
    }

    protected async Task ClosePopupFuttumDetail()
    {
        PopupFuttumDetail = false;
        BookingData.FuttumViewList = await LoadBookingIncidentalDataAsync();
        LoadIncidentalComboboxValue(BookingData.FuttumViewList);
        await InvokeAsync(StateHasChanged);
    }

    private async Task<List<LoadFuttum>> LoadBookingIncidentalDataAsync()
    {
        string uri = string.Format("{0}/api/BookingIncidental/LoadFuttumList?ukeNo={1}&viewMode={2}", baseUrl, id, IncidentalViewMode.All);
        var result = await Http.GetJsonAsync<List<LoadFuttum>>(uri);
        return result;
    }

    void SelectViewBooking(MouseEventArgs e, IncidentalViewMode number)
    {
        IncidentalView = number;
    }

    #endregion

    #region Arrangement

    protected async Task ClosePopupTehai()
    {
        PopupTehai = false;
        BookingData.ArrangementTabList = await LoadBookingArrangementDataAsync(selectedCarArrangement);
        LoadArrangementComboboxValue(BookingData);
        await InvokeAsync(StateHasChanged);
    }

    protected async Task SetupArrangementTab(BookingFormData booking)
    {
        arrangementTypeList = await Http.GetJsonAsync<List<ArrangementType>>(baseUrl + "/api/BookingArrangement/ArrangementType?ukeNo=" + id);
        carArrangementList = await Http.GetJsonAsync<List<ArrangementCar>>(baseUrl + "/api/BookingArrangement/ArrangementCar?ukeNo=" + id);
        selectedCarArrangement = carArrangementList.First();

        arrangementTypeList.Insert(0, ArrangementType.CreateDefault());
    }

    public void LoadArrangementComboboxValue(BookingFormData booking)
    {
        if (arrangementTypeList != null)
        {
            for (int index = 0; index < booking.ArrangementTabList.Count; index++)
            {
                int code = booking.ArrangementTabList[index].SelectedArrangementType.TypeCode;
                booking.ArrangementTabList[index].SelectedArrangementType = arrangementTypeList.FirstOrDefault(t => t.TypeCode == code);
            }
        }
    }

    protected async Task HandleCarArrangementChanged(ArrangementCar newValue)
    {
        selectedCarArrangement = newValue;
        BookingData.ArrangementTabList = await LoadBookingArrangementDataAsync(selectedCarArrangement);
        LoadArrangementComboboxValue(BookingData);
        StateHasChanged();
    }

    private async Task<List<BookingArrangementData>> LoadBookingArrangementDataAsync(ArrangementCar car)
    {
        try
        {
            string uri = string.Format("{0}/api/BookingArrangement?ukeNo={1}&unkRen={2}&teiDanNo={3}&bunkRen={4}", baseUrl, id, car.UnkRen, car.TeiDanNo, car.BunkRen);
            var response = await Http.GetAsync(uri);
            if (response.IsSuccessStatusCode)
            {
                return JsonConvert.DeserializeObject<List<BookingArrangementData>>(await response.Content.ReadAsStringAsync());
            }
            else
            {
                return null;
            }
        }
        catch (Exception)
        {
            return null;
        }
    }

    #endregion

    private bool isValidBookingForm;
    protected bool IsValidBookingForm()
    {
        isValidBookingForm = formContext.GetValidationMessages().Count() == 0;
        return isValidBookingForm;
    }

    protected async Task ConfirmUpdateBooking(bool isUpdate)
    {
        isPopupAskSaveBooking = false;
        if (isUpdate)
        {
            CallBackIndexCommand = CallBackTabBookingState.UpdateBooking;
            await OnChangeCommandState.InvokeAsync(CallBackIndexCommand);
            await InvokeAsync(StateHasChanged);
        }
        else
        {
            waitingTabIndex = -1;
        }
    }

    public void SetActiveTabIndexToWaitting()
    {
        if (waitingTabIndex != -1)
        {
            ActiveTabIndex = waitingTabIndex;
            waitingTabIndex = -1;
        }
    }

    protected void OnValidSubmit()
    {
    }

    protected async Task HandleSaveConfirmationDataList()
    {
        if (BookingData.IsDisableEdit == false)
        {
            waitingTabIndex = 7;
            //CallBackIndexCommand = CallBackTabBookingState.UpdateConfirmTab;
            await OnChangeCommandState.InvokeAsync(CallBackTabBookingState.UpdateConfirmTab);
        }
    }

    protected async Task HandleSaveCancelData()
    {
        if (BookingData.IsDisableEdit == false)
        {
            waitingTabIndex = 8;
            //callBackIndexCommand = CallBackTabBookingState.UpdateCancelTab;
            await OnChangeCommandState.InvokeAsync(CallBackTabBookingState.UpdateCancelTab);
        }
    }

    protected async Task HandleHaitaError()
    {
        await OnChangeCommandState.InvokeAsync(CallBackTabBookingState.HaitaError);
    }

    protected void HandleClosePopup()
    {
        MyPopup.Hide();
        StateHasChanged();
    }

    private async Task Updatefile(List<FileInfoData> updateFileupload)
    {
        await UpdateFileupload.InvokeAsync(updateFileupload);
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private BusScheduleHelper BusScheduleHelper { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<Index> LangIndex { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ITKD_KoteiDataListService TKD_KoteiDataService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IBusBookingDataListService BusBookingDataService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IConfirmationTabService ConfirmationTabService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppSettingsService AppSettingsService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private CustomHttpClient Http { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<BookingInputTab> Lang { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
    }
}
#pragma warning restore 1591
