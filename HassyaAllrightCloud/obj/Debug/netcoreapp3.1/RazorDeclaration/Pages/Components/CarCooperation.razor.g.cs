#pragma checksum "E:\Project\HassyaAllrightCloud\Pages\Components\CarCooperation.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "759eafde9b21fdde65baa60cd84abb58e046b63c"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace HassyaAllrightCloud.Pages.Components
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Infrastructure.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Dto;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Constants;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Extensions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using BlazorContextMenu;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Application.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.IService;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor.Reporting;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 32 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 33 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal;

#line default
#line hidden
#nullable disable
#nullable restore
#line 34 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 35 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 37 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 38 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 39 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components.CommonComponents;

#line default
#line hidden
#nullable disable
    public partial class CarCooperation : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 37 "E:\Project\HassyaAllrightCloud\Pages\Components\CarCooperation.razor"
       
    [Parameter] public string UkeNo { get; set; }
    [Parameter] public short UnkRen { get; set; }
    [Parameter] public int YouTblSeq { get; set; }
    [Parameter] public EventCallback<Dictionary<string, dynamic>> OnClosePopup { get; set; }
    private CarCooperationData carCooperationData = new CarCooperationData();
    private TenantGroupData tenantGroupDataReception = new TenantGroupData();
    private TenantGroupData tenantGroupDataReceptionCustomer = new TenantGroupData();
    private ClientData clientData = new ClientData();
    DateTime minDate = new DateTime();
    DateTime maxDate = new DateTime();
    string date = "";
    bool CloseAndOpenMessage { get; set; } = true;
    string baseUrl;
    #region Component Lifecycle
    /// <summary>
    ///
    /// </summary>
    /// <returns></returns>
    protected override async Task OnInitializedAsync()
    {
        carCooperationData = await CarCooperationService.Getdata(UkeNo, UnkRen, YouTblSeq);
        if(carCooperationData!=null)
        {
            tenantGroupDataReception = await TenantGroupService.GetdataReception(new ClaimModel().TenantID, carCooperationData.TokuiSeq, carCooperationData.SitenCdSeq);
            if(tenantGroupDataReception!=null)
            {
                tenantGroupDataReceptionCustomer = await TenantGroupService.GetdataReceptionCustomer(tenantGroupDataReception.SitenCdSeqTenantCdSeq, tenantGroupDataReception.TenantGroupCdSeq, tenantGroupDataReception.TenantCdSeq);
                if(tenantGroupDataReceptionCustomer!=null)
                {
                    carCooperationData.MotoTokuiSeq = tenantGroupDataReceptionCustomer.TokuiSeq;
                    carCooperationData.MotoSitenCdSeq = tenantGroupDataReceptionCustomer.SitenCdSeq;
                }
                carCooperationData.UkeTenantCdSeq = tenantGroupDataReception.SitenCdSeqTenantCdSeq;
            }

            DateTime.TryParseExact(carCooperationData.MinDate+carCooperationData.MinTime,
                              "yyyyMMddHHmm",
                              CultureInfo.CurrentCulture,
                              DateTimeStyles.None,
                              out minDate);
            DateTime.TryParseExact(carCooperationData.MaxDate+carCooperationData.MaxTime,
                              "yyyyMMddHHmm",
                              CultureInfo.CurrentCulture,
                              DateTimeStyles.None,
                              out maxDate);
            date=minDate.ToString("yyyy年MM月dd日 (ddd) HH:mm") +"　～　"+ maxDate
                .ToString("yyyy年MM月dd日 (ddd) HH:mm");
        }
    }
    /// <summary>
    /// 
    /// </summary>
    /// <param name="value"></param>
    /// <returns></returns>
    public async Task OpenPopupInformation(bool value)
    {
        try
        {
            if(carCooperationData.UkeTenantCdSeq==0|| carCooperationData.MotoTokuiSeq==0|| carCooperationData.MotoSitenCdSeq==0)
            {
                var parameter = new Dictionary<string, dynamic>();
                parameter.Add("OpenPopup", value);
                parameter.Add("Status", "Error");
                await OnClosePopup.InvokeAsync(parameter);
            }
            else
            {
                baseUrl = AppSettingsService.GetBaseUrl();
                var client = await Http.GetHttpClient();
                HttpResponseMessage response = await client.PostAsync($"{baseUrl}/api/TkdYoushaNotice/", Http.getStringContentFromObject(carCooperationData));
                if ((int)response.StatusCode == 200)
                {
                    clientData = await TenantGroupService.GetClienData(carCooperationData.UkeTenantCdSeq, carCooperationData.MotoTokuiSeq, carCooperationData.MotoSitenCdSeq);
                    List<string> emailLst = new List<string>();
                    emailLst.Add(carCooperationData.TokuiMail);
                    string ukeTenant = await TenantGroupService.GetTenantName(carCooperationData.UkeTenantCdSeq);
                    string emailSubject = string.Format(Lang["emailSubject"], DateTime.Now.ToString("yyyy年MM月dd日 (ddd) HH:mm"),carCooperationData.TokuiMail, carCooperationData.UkeCd.ToString("D10"));
                    string emailcontent = string.Format(Lang["emailContent"], ukeTenant, "kidoku", carCooperationData.UkeCd.ToString("D10"), carCooperationData.DanTaNm, minDate.ToString("yyyy年MM月dd日 (ddd) HH:mm"), maxDate
                            .ToString("yyyy年MM月dd日 (ddd) HH:mm"), clientData.TokuiCd.ToString("D4"), clientData.TokuiNm, clientData.SitenCd.ToString("D4"), clientData.SitenNm, carCooperationData.LargeCount, carCooperationData.MediumCount, carCooperationData.SmallCount, "kidoku");
                    try
                    {
                        var sentmail = await NotificationToStaffService.SendMail(emailLst, emailSubject, emailcontent);
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine(ex.Message);
                        //TODO use logger to log down exception ex.message
                    }
                    var parameter = new Dictionary<string, dynamic>();
                    parameter.Add("OpenPopup", value);
                    parameter.Add("Status", "Success");
                    await OnClosePopup.InvokeAsync(parameter);
                }
                else
                {
                    var parameter = new Dictionary<string, dynamic>();
                    parameter.Add("OpenPopup", value);
                    parameter.Add("Status", "Error");
                    await OnClosePopup.InvokeAsync(parameter);
                }
            }

        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
            //TODO use logger to log down exception ex.message
        }


    }

    public async Task ClosePopupCarCooperation(bool value)
    {

    }
    /// <summary>
    /// 
    /// </summary>
    /// <param name="e"></param>
    /// <returns></returns>
    private async Task Cancel(MouseEventArgs e)
    {
        var parameter = new Dictionary<string, dynamic>();
        parameter.Add("OpenPopup", false);
        parameter.Add("Status", "Error");
        await OnClosePopup.InvokeAsync(parameter);
    }
    #endregion

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private INotificationToStaffService NotificationToStaffService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppSettingsService AppSettingsService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private CustomHttpClient Http { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ITenantGroupServiceService TenantGroupService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ICarCooperationListService CarCooperationService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<CarCooperation> Lang { get; set; }
    }
}
#pragma warning restore 1591
