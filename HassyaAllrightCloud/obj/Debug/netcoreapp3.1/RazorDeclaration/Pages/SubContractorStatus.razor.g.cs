#pragma checksum "E:\Project\HassyaAllrightCloud\Pages\SubContractorStatus.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "2f05e7f0b789ab9cdc60dc5d2107343f07d368f4"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace HassyaAllrightCloud.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Infrastructure.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Domain.Dto;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Constants;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Commons.Extensions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using BlazorContextMenu;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Application.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Validation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Newtonsoft.Json.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.IService;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using LexLibrary.Line.NotifyBot;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using DevExpress.Blazor.Reporting;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using HassyaAllrightCloud.Pages.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 32 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 33 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal;

#line default
#line hidden
#nullable disable
#nullable restore
#line 34 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Blazored.Modal.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 35 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using SharedLibraries.UI.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 37 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 38 "E:\Project\HassyaAllrightCloud\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "E:\Project\HassyaAllrightCloud\Pages\SubContractorStatus.razor"
using HassyaAllrightCloud.Pages.Components.CommonComponents;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "E:\Project\HassyaAllrightCloud\Pages\SubContractorStatus.razor"
using HassyaAllrightCloud.Domain.Dto.SubContractorStatus;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "E:\Project\HassyaAllrightCloud\Pages\SubContractorStatus.razor"
using HassyaAllrightCloud.Domain.Dto.CommonComponents;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/subcontractorstatus")]
    public partial class SubContractorStatus : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 565 "E:\Project\HassyaAllrightCloud\Pages\SubContractorStatus.razor"
       
    EditContext formContext;
    int activeTabIndex = 0;
    bool isTabChange = false;
    int ActiveTabIndex { get => activeTabIndex; set { activeTabIndex = value; isTabChange = true; StateHasChanged(); } }
    string baseUrl;

    SubContractorStatusData data = new SubContractorStatusData();
    private List<LoadCustomerList> Customers = new List<LoadCustomerList>();
    private List<ReservationData> BookingTypes = new List<ReservationData>();
    private List<CompanyData> Companies = new List<CompanyData>();
    private List<LoadSaleBranch> Branches = new List<LoadSaleBranch>();
    private List<LoadStaff> Staffs = new List<LoadStaff>();
    private List<SelectedOption<OwnCompanyType>> OwnCompanyTypes = new List<SelectedOption<OwnCompanyType>>();
    private List<SelectedOption<ContractorOutputOrder>> OutputOrders = new List<SelectedOption<ContractorOutputOrder>>();
    private List<SelectedOption<GroupDivision>> Group = new List<SelectedOption<GroupDivision>>();
    private List<SelectedOption<PageBreak>> PageBreakTypes = new List<SelectedOption<PageBreak>>();
    private List<PaperSize> PaperSizeOptions = new List<PaperSize>();
    private List<SelectedOption<CSV_Header>> CsvHeaderOptions = new List<SelectedOption<CSV_Header>>();
    private List<SelectedOption<CSV_Group>> CsvGroupSymbolOptions = new List<SelectedOption<CSV_Group>>();
    private List<SelectedOption<CSV_Delimiter>> CsvDelimiterOptions = new List<SelectedOption<CSV_Delimiter>>();
    private IEnumerable<CompanyData> CompanySelecteds = new List<CompanyData>();
    private CustomerComponent CustomerFromRef { get; set; }
    private CustomerComponent CustomerToRef { get; set; }
    private DefaultCustomerData DefaultValueCustomerFrom { get; set; } = new DefaultCustomerData();
    private DefaultCustomerData DefaultValueCustomerTo { get; set; } = new DefaultCustomerData();

    protected ReservationClassComponent reservationFromRef;
    protected ReservationClassComponent reservationToRef;
    private int DefaultValueReservationFrom;
    private int DefaultValueReservationTo;

    private bool IsCompanySelectedAll = true;
    private bool IsSelectEmptyCompany = false;

    private string DisplayBookingTypeCmb = string.Empty;
    private bool isSearching = false;
    private bool isFilterApply = false;
    private bool isLoading = true;
    private bool isExportable = false;
    private bool notifyNotFound = false;
    private bool cmbCompanyIsError = false;
    private bool disableCmbBreakPage = false;

    private string filterConditionFormName = "KU4000";

    private Pagination pagination = new Pagination();
    private int CurrentPage = 1;
    private int RecordsPerPage = 25;
    private int TotalItems = 0;

    private SubContractorStatusSearchPaged PagedResultData = new SubContractorStatusSearchPaged();

    private HeaderTemplate Header { get; set; } = new HeaderTemplate();
    private HeaderTemplate headerTemplate { get; set; } = new HeaderTemplate();

    private BodyTemplate Body { get; set; }

    private ClaimModel GetCurrentUserInfo;

    #region Localization string
    private string NotFound;
    Dictionary<string, string> LangDic = new Dictionary<string, string>();
    private void LocalizationInit()
    {
        var dataLang = Lang.GetAllStrings();
        LangDic = dataLang.ToDictionary(l => l.Name, l => l.Value);

        NotFound = Lang["BI_T007"];

    }
    #endregion

    #region Component Lifecycle
    protected override async Task OnInitializedAsync()
    {
        try
        {
            Header = new HeaderTemplate();
            headerTemplate = new HeaderTemplate();
            baseUrl = AppSettingsService.GetBaseUrl();
            formContext = new EditContext(data);
            formContext.OnValidationStateChanged += OnValidationStateChanged;
            GetCurrentUserInfo = new ClaimModel();

            LocalizationInit();
            LoadStaticData();

            await Task.Run(async () =>
            {
                await LoadCompany();
                await LoadBranch();
                await LoadStaff();
            })
                .ContinueWith(async (t) =>
                {
                    ApplyFillter();
                    isExportable = formContext.Validate();
                    GenrateGrid();
                    isLoading = false;

                    await InvokeAsync(StateHasChanged);
                    await OnButtonSearchClicked();
                });
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);

            isLoading = false;
            await InvokeAsync(StateHasChanged);
        }
    }

    #endregion

    #region Load Data
    private async Task OnInitCustomerReservation()
    {
        DefaultValueReservationFrom = DefaultValueReservationTo = -1;
        DefaultValueCustomerFrom.GyosyaCdSeq = DefaultValueCustomerTo.GyosyaCdSeq = -1;
        DefaultValueCustomerFrom.TokiskCdSeq = DefaultValueCustomerTo.TokiskCdSeq = -1;
        DefaultValueCustomerFrom.TokiStCdSeq = DefaultValueCustomerTo.TokiStCdSeq = -1;
        data.SelectedGyosyaFrom = data.SelectedGyosyaTo = null;
        data.SelectedTokiskFrom = data.SelectedTokiskFrom = null;
        data.SelectedTokiStFrom = data.SelectedTokiStTo = null;
        data.RegistrationTypeFrom = data.RegistrationTypeTo = null;
        await Task.Yield();
        await CustomerFromRef.RenderDefault();
        await CustomerToRef.RenderDefault();
    }

    private async Task LoadCompany()
    {
        Companies = await CompanyDataService.GetCompanyByTenantIdAsync(new ClaimModel().TenantID);

        if (Companies.Any())
        {
            if (!Companies.Any(_ => _ != null && _.IsSelectedAll))
                Companies.Insert(0, new CompanyData { IsSelectedAll = true });
            data.Companies = Companies;

            CompanySelecteds = Companies;
        }
        else
        {
        }
        //data.Company = Companies.FirstOrDefault();
    }

    private async Task LoadBranch()
    {
        Branches = await BranchDataService.GetBranchDataByCompanies(new ClaimModel().TenantID, data.Companies.Where(_ => _ != null).Select(_ => _.CompanyCdSeq).ToList());

        InsertSelectAll(Branches);

        if (!isFilterApply)
        {
            data.BranchStart = Branches.FirstOrDefault();
            data.BranchEnd = Branches.FirstOrDefault();
        }
    }

    private async Task LoadStaff()
    {
        Staffs = await StaffService.GetStaffByTenantIdAsync(new ClaimModel().TenantID,
            data.StartDate.ToString("yyyyMMdd"),
            data.EndDate.ToString("yyyyMMdd"));
        InsertSelectAll(Staffs);

        data.StaffStart = Staffs.FirstOrDefault();
        data.StaffEnd = Staffs.FirstOrDefault();
    }

    private void LoadStaticData()
    {
        data.DateTypeText = Lang["DateOfDispatch"];

        OwnCompanyTypes = new List<SelectedOption<OwnCompanyType>>(){
            new SelectedOption<OwnCompanyType>{Option = OwnCompanyType.Output, DisplayName= Lang["Output"] },
            new SelectedOption<OwnCompanyType>{Option = OwnCompanyType.NoOutput, DisplayName= Lang["NoOutput"] },
        };
        data.OwnCompanyType = OwnCompanyTypes.LastOrDefault();

        OutputOrders = new List<SelectedOption<ContractorOutputOrder>>(){
            new SelectedOption<ContractorOutputOrder>{Option = ContractorOutputOrder.Dispatch, DisplayName= Lang["DateOfDispatch"] },
            new SelectedOption<ContractorOutputOrder>{Option = ContractorOutputOrder.Arrival, DisplayName= Lang["DateOfArrival"] },
        };
        data.OutputOrder = OutputOrders.FirstOrDefault();

        Group = new List<SelectedOption<GroupDivision>>(){
            new SelectedOption<GroupDivision>{Option = GroupDivision.All, DisplayName= Lang["All"] },
            new SelectedOption<GroupDivision>{Option = GroupDivision.ParentCompanies, DisplayName= Lang["CarDestination"] },
            new SelectedOption<GroupDivision>{Option = GroupDivision.SubsidiaryCompanies, DisplayName= Lang["CarDestinationBranch"] },
        };
        data.Group = Group.FirstOrDefault();
        disableCmbBreakPage = true;

        PageBreakTypes = new List<SelectedOption<PageBreak>>(){
            new SelectedOption<PageBreak>{Option = PageBreak.Yes, DisplayName= Lang["Yes"] },
            new SelectedOption<PageBreak>{Option = PageBreak.No, DisplayName= Lang["No"] },
        };
        data.PageBreak = PageBreakTypes.FirstOrDefault();

        PaperSizeOptions = new List<PaperSize>{
            PaperSize.A4,
            PaperSize.A3,
            PaperSize.B4,
        };
        data.PaperSize = PaperSizeOptions.FirstOrDefault();

        CsvHeaderOptions = new List<SelectedOption<CSV_Header>>(){
            new SelectedOption<CSV_Header>{Option = CSV_Header.IncludeHeader, DisplayName= Lang["CsvHadHeader"] },
            new SelectedOption<CSV_Header>{Option = CSV_Header.WithoutHeader, DisplayName= Lang["CsvWithoutHeader"] },
        };
        data.CsvConfigOption.Header = CsvHeaderOptions.FirstOrDefault();

        CsvGroupSymbolOptions = new List<SelectedOption<CSV_Group>>(){
            new SelectedOption<CSV_Group>{Option = CSV_Group.QuotationMarks, DisplayName= Lang["CsvGrQuotesMarks"]},
            new SelectedOption<CSV_Group>{Option = CSV_Group.WithoutQuotes, DisplayName= Lang["CsvGrWithoutQuotes"]},
        };
        data.CsvConfigOption.GroupSymbol = CsvGroupSymbolOptions.FirstOrDefault();

        CsvDelimiterOptions = new List<SelectedOption<CSV_Delimiter>>(){
            new SelectedOption<CSV_Delimiter>{Option = CSV_Delimiter.Comma, DisplayName= Lang["CsvSpaceComma"]},
            new SelectedOption<CSV_Delimiter>{Option = CSV_Delimiter.Semicolon, DisplayName= Lang["CsvSpaceSemicolon"]},
            new SelectedOption<CSV_Delimiter>{Option = CSV_Delimiter.Space, DisplayName= Lang["CsvSpacing"]},
            new SelectedOption<CSV_Delimiter>{Option = CSV_Delimiter.FixedLength, DisplayName= Lang["CsvSpaceFixedLength"]},
            new SelectedOption<CSV_Delimiter>{Option = CSV_Delimiter.Other, DisplayName= Lang["CsvSpaceOther"]},
        };
        data.CsvConfigOption.Delimiter = CsvDelimiterOptions.FirstOrDefault();
    }

    private void InsertSelectAll<T>(List<T> source) where T : class
    {
        if (source.Any(item => item is null))
            return;

        source.Insert(0, null);
    }
    #endregion

    #region Value Changed Method

    private async Task FormViewSizeChanged(ViewMode formViewSize)
    {
        try
        {
            data.FormViewSize = formViewSize;

            if (!isFilterApply)
            {
                await SaveCurrentFilter();
                await InvokeAsync(StateHasChanged);
            }
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void DateTypeChanged(MouseEventArgs e, DateType dateType)
    {
        try
        {
            data.DateTypeText = dateType switch
            {
                DateType.Arrival => Lang["DateOfArrival"],
                DateType.Dispatch => Lang["DateOfDispatch"],
                _ => string.Empty,
            };

            data.DateType = dateType;

            if (!isFilterApply)
            {
                await OnButtonSearchClicked();
            }
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void OnDateChanged(DateTime newDate, bool isStart = true)
    {
        try
        {
            if (isStart)
            {
                data.StartDate = newDate;
            }
            else
            {
                data.EndDate = newDate;
            }

            if (!isFilterApply)
                //await LoadCustomer().ContinueWith(async t => { await OnButtonSearchClicked(); });
                await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void OnUkeCdChanged(string newUkeCd, bool isFrom = true)
    {
        try
        {
            if (isFrom)
            {
                data.UkeCdFrom = newUkeCd;
            }
            else
            {
                data.UkeCdTo = newUkeCd;
            }

            if (!isFilterApply)
                await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void OnCompanySelectedChanged(IEnumerable<CompanyData> companies)
    {
        try
        {
            int newCount = companies.Count();
            int maxCount = Companies.Count();

            CompanySelecteds = companies;

            bool isContainSelectAll = CompanySelecteds.Where(_ => _.IsSelectedAll).Any();
            if (!isFilterApply)
            {
                if (IsCompanySelectedAll == true)
                {
                    if (!isContainSelectAll)
                    {
                        CompanySelecteds = CompanySelecteds.Take(0);
                        IsCompanySelectedAll = false;
                    }
                    else if (isContainSelectAll && newCount < maxCount)
                    {
                        CompanySelecteds = CompanySelecteds.Where(_ => !_.IsSelectedAll);
                        IsCompanySelectedAll = false;
                    }
                }
                else
                {
                    if (isContainSelectAll)
                    {
                        CompanySelecteds = Companies;
                        IsCompanySelectedAll = true;
                    }
                    else if (!isContainSelectAll && newCount == maxCount - 1)
                    {
                        CompanySelecteds = Companies;
                        IsCompanySelectedAll = true;
                    }
                }
            }
            data.Companies = CompanySelecteds.Select(_ => new CompanyData { CompanyCdSeq = _.CompanyCdSeq }).ToList();

            Branches = await BranchDataService.GetBranchDataByCompanies(GetCurrentUserInfo.TenantID, data.Companies?.Select(_ => _.CompanyCdSeq).ToList());
            InsertSelectAll(Branches);
            if (Branches.Any())
            {
                data.BranchStart = Branches.FirstOrDefault(_ => _ != null && _.EigyoCdSeq == (data.BranchStart?.EigyoCdSeq ?? 0));
                data.BranchEnd = Branches.FirstOrDefault(_ => _ != null && _.EigyoCdSeq == (data.BranchEnd?.EigyoCdSeq ?? 0));
            }
            await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private string GetSelectedCompanyText()
    {
        int newCount = CompanySelecteds.Count();
        int maxCount = Companies.Count();
        string displayText = string.Empty;
        try
        {
            if (newCount == 1 && (!CompanySelecteds.FirstOrDefault()?.IsSelectedAll ?? false))
            {
                displayText = CompanySelecteds.FirstOrDefault()?.CompanyInfo ?? string.Empty;
            }
            else if (newCount == maxCount)
            {
                displayText = Constants.SelectedAll;
            }
            else
            {
                displayText = $"{Lang["Choices"]}: {newCount}";
            }
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
        return displayText;
    }

    private async void OnSaleBranchChanged(LoadSaleBranch newBranch, bool isFrom = true)
    {
        try
        {
            if (isFrom)
            {
                data.BranchStart = newBranch;
            }
            else
            {
                data.BranchEnd = newBranch;
            }

            if (!isFilterApply)
                await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void OnStaffSelectedChanged(LoadStaff newStaff, bool isFrom = true)
    {
        try
        {
            if (isFrom)
            {
                data.StaffStart = newStaff;
            }
            else
            {
                data.StaffEnd = newStaff;
            }

            if (!isFilterApply)
                await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void OnOwnCompanyTypeChanged(SelectedOption<OwnCompanyType> newValue)
    {
        try
        {
            data.OwnCompanyType = newValue;

            if (!isFilterApply)
                await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void OnOutputOrderChanged(SelectedOption<ContractorOutputOrder> order)
    {
        try
        {
            data.OutputOrder = order;

            if (!isFilterApply)
                await OnButtonSearchClicked();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private void OnGroupDivisionChanged(SelectedOption<GroupDivision> group)
    {
        data.Group = group;

        disableCmbBreakPage = group.Option == GroupDivision.All;

        if (!isFilterApply)
            StateHasChanged();
    }

    private void OnPageBreakChanged(SelectedOption<PageBreak> pagebreak)
    {
        data.PageBreak = pagebreak;

        if (!isFilterApply)
            StateHasChanged();
    }

    private void OnExportTypeClicked(MouseEventArgs e, OutputReportType type)
    {
        try
        {
            if (data.ExportType == OutputReportType.CSV && type != OutputReportType.CSV)
            {
                //Reset fields in CSV config form
                data.CsvConfigOption.DelimiterSymbol = string.Empty;
                data.CsvConfigOption.GroupSymbol = CsvGroupSymbolOptions.First();
                data.CsvConfigOption.Header = CsvHeaderOptions.First();
                data.CsvConfigOption.Delimiter = CsvDelimiterOptions.First();
            }
            data.ExportType = type;

            formContext.Validate();

            if (!isFilterApply)
                StateHasChanged();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private void OnPaperSizeChanged(PaperSize size)
    {
        data.PaperSize = size;

        if (!isFilterApply)
            StateHasChanged();
    }

    private void OnCsvHeaderChanged(SelectedOption<CSV_Header> selectedItems)
    {
        data.CsvConfigOption.Header = selectedItems;

        if (!isFilterApply)
            StateHasChanged();
    }

    private void OnGroupSymbolChanged(SelectedOption<CSV_Group> selectedItems)
    {
        data.CsvConfigOption.GroupSymbol = selectedItems;

        if (!isFilterApply)
            StateHasChanged();
    }

    private void OnSeparatorChanged(SelectedOption<CSV_Delimiter> selectedItems)
    {
        try
        {
            if (data.CsvConfigOption.Delimiter.Option == CSV_Delimiter.Other && selectedItems.Option != CSV_Delimiter.Other)
            {
                data.CsvConfigOption.DelimiterSymbol = string.Empty;
            }
            if (selectedItems.Option == CSV_Delimiter.FixedLength)
            {
                data.CsvConfigOption.GroupSymbol = CsvGroupSymbolOptions.Where(_ => _.Option == CSV_Group.WithoutQuotes).FirstOrDefault();
                data.CsvConfigOption.Header = CsvHeaderOptions.Where(_ => _.Option == CSV_Header.WithoutHeader).FirstOrDefault();
            }
            data.CsvConfigOption.Delimiter = selectedItems;

            if (!isFilterApply)
                StateHasChanged();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private void OnDelimiterTextChanged(string newValue)
    {
        data.CsvConfigOption.DelimiterSymbol = newValue;

        if (!isFilterApply)
            StateHasChanged();
    }
    #endregion


    #region Action

    private async Task OnButtonSearchClicked()
    {
        if (!formContext.Validate() || isFilterApply)
        {
            await InvokeAsync(StateHasChanged);
            return;
        }
        await LoadingService.ShowAsync();

        try
        {
            data.BookingTypes = BookingTypes.Where(_ => _ != null).ToList();
            PagedResultData = await SubContractorStatusReportService.SearchSubContractorStatusSearchPaged(data, new ClaimModel().TenantID, CurrentPage, RecordsPerPage);
            data.BookingTypes = null;

            TotalItems = PagedResultData.TotalRecord;

            if (PagedResultData.PageData.Any())
            {
                await SaveCurrentFilter();
            }
            else
            {
                notifyNotFound = true;
            }
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
        await LoadingService.HideAsync();
        await InvokeAsync(StateHasChanged);
    }

    private async void OnButtonReportClicked(MouseEventArgs args)
    {
        if (!isExportable)
            return;

        try
        {
            switch (data.ExportType)
            {
                case OutputReportType.Preview:
                    await PreviewReport();
                    break;
                case OutputReportType.Print: //disable this feature
                    notifyNotFound = true;
                    break;
                case OutputReportType.ExportPdf:
                    await PDFReport();
                    break;
                case OutputReportType.CSV:
                    await CSVReport();
                    break;
                default:
                    break;
            }
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    void MenuOnAppearingHandler(MenuAppearingEventArgs e)
    {
        if (e.Data != null)
        {
            // to do
        }
        StateHasChanged();
    }

    private async void HandleClearSearchCondition()
    {
        try
        {
            isLoading = true;
            IsCompanySelectedAll = true;
            DisplayBookingTypeCmb = string.Empty;

            isFilterApply = false;
            isExportable = false;
            notifyNotFound = false;
            cmbCompanyIsError = false;
            disableCmbBreakPage = false;

            CurrentPage = 1;
            RecordsPerPage = 25;
            TotalItems = 0;
            pagination.currentPage = CurrentPage;

            data.DateType = DateType.Dispatch;
            data.StartDate = data.EndDate = DateTime.Now;
            data.UkeCdFrom = data.UkeCdTo = "";
            data.Companies = Companies;
            await OnInitCustomerReservation();
            data.BranchStart = data.BranchEnd = Branches.FirstOrDefault();
            data.StaffStart = data.StaffEnd = Staffs.FirstOrDefault();
            data.OwnCompanyType = OwnCompanyTypes.LastOrDefault();
            data.OutputOrder = OutputOrders.FirstOrDefault();
            data.FormViewSize = ViewMode.Medium;
            data.ExportType = OutputReportType.Preview;
            data.PaperSize = PaperSizeOptions.FirstOrDefault();
            data.Group = Group.FirstOrDefault();
            data.PageBreak = PageBreakTypes.FirstOrDefault();
            data.CsvConfigOption.Header = CsvHeaderOptions.FirstOrDefault();
            data.CsvConfigOption.GroupSymbol = CsvGroupSymbolOptions.FirstOrDefault();
            data.CsvConfigOption.Delimiter = CsvDelimiterOptions.FirstOrDefault();
            data.BookingTypes = BookingTypes;
            await OnButtonSearchClicked();
            //await InvokeAsync(StateHasChanged);

            isLoading = false;
            await InvokeAsync(StateHasChanged);
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }
    #endregion

    #region Export

    private async Task PreviewReport()
    {
        isSearching = true;
        StateHasChanged();

        var param = GetReportParam(data);
        param.SearchCondition.CompanyIds = param.SearchCondition.Companies.Select(_ => _.CompanyCdSeq).ToList();
        param.SearchCondition.Companies = null;
        param.SearchCondition.BookingTypes = null;
        bool ableToExport = PagedResultData.TotalRecord > 0;

        if (ableToExport)
        {
            RedirectToPreviewPage();
        }
        else
        {
            var src = await SubContractorStatusReportService.GetSubContractorStatusReportData(param);

            if (src.Any())
            {
                RedirectToPreviewPage();
            }
            else
            {
                notifyNotFound = true;
            }
        }

        isSearching = false;
        StateHasChanged();

        void RedirectToPreviewPage()
        {
            var searchString = EncryptHelper.EncryptToUrl(param);
            IJSRuntime.InvokeVoidAsync("open", "SubContractorStatusReportPreview?searchString=" + searchString, "_blank");
        }
    }

    private async Task PDFReport()
    {
        isSearching = true;
        await InvokeAsync(StateHasChanged);

        try
        {
            await Handle();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }

        isSearching = false;
        await InvokeAsync(StateHasChanged);

        async Task Handle()
        {
            var result = await SubContractorStatusReportService.GetSubContractorStatusReportPagedData(GetReportParam(data));

            if (result.Any())
            {
                DevExpress.XtraReports.UI.XtraReport report = new DevExpress.XtraReports.UI.XtraReport();

                switch (data.PaperSize)
                {
                    case PaperSize.A3:
                        report = new Reports.ReportTemplate.SubContractor.SubContractorA3();
                        break;
                    case PaperSize.A4:
                        report = new Reports.ReportTemplate.SubContractor.SubContractorA4();
                        break;
                    case PaperSize.B4:
                        report = new Reports.ReportTemplate.SubContractor.SubContractorB4();
                        break;
                    default:
                        break;
                }

                report.DataSource = result;
                await new System.Threading.Tasks.TaskFactory().StartNew(() =>
                {
                    report.CreateDocument();
                    using (MemoryStream ms = new MemoryStream())
                    {
                        report.ExportToPdf(ms);

                        byte[] exportedFileBytes = ms.ToArray();
                        string myExportString = Convert.ToBase64String(exportedFileBytes);
                        IJSRuntime.InvokeVoidAsync("downloadFileClientSide", myExportString, "pdf", "SubContractorStatusReport");
                    }
                });
            }
            else
            {
                notifyNotFound = true;
            }
        }
    }

    private async Task CSVReport()
    {
        isSearching = true;
        StateHasChanged();

        try
        {
            await HandleCSV();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }

        isSearching = false;
        StateHasChanged();

        async Task HandleCSV()
        {
            //this temp path to check valid
            string path = string.Format("{0}/csv/{1}.csv", HostingEnvironment.WebRootPath, Guid.NewGuid());

            var reportData = await SubContractorStatusReportService.GetSubContractorStatusCsvData(GetReportParam(data));

            if (reportData.Any())
            {
                var csvData = reportData.Cast<SubContractorStatusExportCsvData>().ToList();

                var result = CsvHelper.ExportCollectionToCsv(
                    csvData,
                    new CsvConfigOption
                    {
                        FilePath = path.Substring(0, path.LastIndexOf("/")),
                        Delimiter = data.CsvConfigOption.Delimiter,
                        DelimiterSymbol = data.CsvConfigOption.DelimiterSymbol,
                        GroupSymbol = data.CsvConfigOption.GroupSymbol,
                        Header = data.CsvConfigOption.Header,
                    },
                    SetupHeaderCsvReport());

                await new System.Threading.Tasks.TaskFactory().StartNew(() =>
                {
                    string myExportString = Convert.ToBase64String(result);
                    IJSRuntime.InvokeVoidAsync("downloadFileClientSide", myExportString, "csv", "SubContractorStatusReport");
                });
            }
            else
            {
                notifyNotFound = true;
            }
        }
    }

    private SubContractorStatusReportSearchParams GetReportParam(SubContractorStatusData searchCondition)
    {
        var condition = new SubContractorStatusData();
        condition.SimpleCloneProperties(searchCondition);
        condition.BookingTypes = BookingTypes.Where(_ => _ != null).ToList();
        SubContractorStatusReportSearchParams param = new SubContractorStatusReportSearchParams
        {
            TenantId = new ClaimModel().TenantID,
            UserLoginId = new ClaimModel().SyainCdSeq,
            SearchCondition = condition,
        };

        return param;
    }

    private List<string> SetupHeaderCsvReport()
    {
        return new List<string>
{
            "No",
            "予約区分", "予約区分名","受付番号", "運行日連番","運行配車年月日", "運行到着年月日",
            "業者コード", "得意先コード", "得意先支店コード", "得意先名", "得意先支店名", "得意先略名", "得意先支店略名", "得意先担当者名",
            "得意先電話番号", "受付営業所コード", "受付営業所名", "受付営業所略名", "団体名", "行先名", "配車地名(運行日)",
            "配車時間(運行日)", "配車地住所1(運行日)", "配車地住所2(運行日)", "配車地交通機関分類コード(運行日)", "配車地交通機関コード(運行日)",
            "配車地交通機関分類名(運行日)", "配車地交通機関分類略名(運行日)", "配車地交通機関名(運行日)",  "配車地交通機関略名(運行日)",
            "配車地便コード(運行日)", "配車地便名(運行日)", "到着地名(運行日)", "到着時間(運行日)", "到着地住所1(運行日)", "到着地住所2(運行日)",
            "到着地交通機関分類コード(運行日)", "到着地交通機関コード(運行日)", "到着地交通機関分類名(運行日)", "到着地交通機関分類略名(運行日)",
            "到着地交通機関名(運行日)", "到着地交通機関略名(運行日)", "到着地便コード(運行日)", "到着地便名(運行日)", "乗車人員(運行日)",
            "プラス人員(運行日)", "総台数", "運賃", "税区分", "税区分名", "消費税率", "消費税額", "手数料率", "手数料額", "運賃合計",
            "ガイド料", "ガイド料消費税", "ガイド料手数料", "ガイド料合計", "付帯積込品額", "付帯積込品消費税","付帯積込品手数料額", "付帯積込品合計",
            "傭車先業者区分", "傭車先コード","傭車先支店コード", "傭車先名","傭車先支店名", "傭車先略名",
            "傭車先支店略名", "号車","団体名２", "行先名(配車)","配車地名(配車)", "配車年月日(配車)","配車時間(配車)",
            "配車地住所1(配車)", "配車地住所2(配車)", "配車地交通機関分類コード(配車)","配車地交通機関コード(配車)", "配車地交通機関分類名(配車)",
            "配車地交通機関分類略名(配車)", "配車地交通機関名(配車)","配車地交通機関略名(配車)", "配車地便コード(配車)",
            "配車地便名(配車)", "到着地名(配車)", "到着年月日(配車)", "到着時間(配車)", "到着地住所1(配車)", "到着地住所2(配車)",
            "到着地交通機関分類コード(配車)", "到着地交通機関コード(配車)", "到着地交通機関分類名(配車)", "到着地交通機関分類略名(配車)",
            "到着地交通機関名(配車)", "到着地交通機関略名(配車)","到着地便コード(配車)", "到着地便名(配車)","乗車人員(配車)",
            "プラス人員(配車)","傭車運賃", "傭車税区分","傭車税区分名", "傭車消費税率","傭車消費税額", "傭車手数料率",
            "傭車手数料額", "傭車運賃合計","傭車ガイド料", "傭車ガイド料消費税",
            "傭車ガイド料手数料", "傭車ガイド料合計","傭車付帯積込品額", "傭車付帯積込品消費税","傭車付帯積込品手数料額", "傭車付帯積込品合計"
        };
    }
    #endregion

    #region Fillter form value

    private async Task SaveCurrentFilter()
    {
        try
        {
            await FilterServices.SaveCustomFilterAndConditions(data.ToDictionary(), filterConditionFormName, GetCurrentUserInfo.SyainCdSeq);
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private async void ApplyFillter()
    {
        try
        {
            await Handle();
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }

        async Task Handle()
        {
            var filterValues = (await FilterServices.GetFilterCondition(filterConditionFormName, GetCurrentUserInfo.SyainCdSeq))
                                .ToDictionary(inp => inp.ItemNm, inp => inp.JoInput).ConvertMultipleToSingleValues()
                                .ConvertMultipleToSingleValues();

            if (filterValues?.Any() ?? false)
            {
                isFilterApply = true;
                var tempModel = new SubContractorStatusData();
                tempModel.ApplyDictionary(ref data, DefaultValueCustomerFrom, DefaultValueCustomerTo, DefaultValueReservationFrom, DefaultValueReservationTo, filterValues);
                data.SimpleCloneProperties(tempModel);

                DateTypeChanged(null, data.DateType);
                OnDateChanged(tempModel.StartDate);
                OnDateChanged(tempModel.EndDate, false);

                OnCompanySelectedChanged(Companies.Where(_ => _ != null).Where(c => data.Companies.Select(_ => _.CompanyCdSeq).Contains(c.CompanyCdSeq)));
                OnSaleBranchChanged(tempModel.BranchStart == null ? null : Branches.FirstOrDefault(_ => _ != null && _.EigyoCdSeq == tempModel.BranchStart.EigyoCdSeq));
                OnSaleBranchChanged(tempModel.BranchEnd == null ? null : Branches.FirstOrDefault(_ => _ != null && _.EigyoCdSeq == tempModel.BranchEnd.EigyoCdSeq), false);
                OnStaffSelectedChanged(tempModel.StaffStart == null ? null : Staffs.FirstOrDefault(_ => _ != null && _.SyainCdSeq == tempModel.StaffStart.SyainCdSeq));
                OnStaffSelectedChanged(tempModel.StaffEnd == null ? null : Staffs.FirstOrDefault(_ => _ != null && _.SyainCdSeq == tempModel.StaffEnd.SyainCdSeq), false);

                OnOwnCompanyTypeChanged(OwnCompanyTypes.FirstOrDefault(_ => _.Option == tempModel.OwnCompanyType.Option));
                OnOutputOrderChanged(OutputOrders.FirstOrDefault(_ => _.Option == tempModel.OutputOrder.Option));
                OnOwnCompanyTypeChanged(OwnCompanyTypes.FirstOrDefault(_ => _.Option == tempModel.OwnCompanyType.Option));
                OnGroupDivisionChanged(Group.FirstOrDefault(_ => _.Option == tempModel.Group.Option));
                OnPageBreakChanged(PageBreakTypes.FirstOrDefault(_ => _.Option == tempModel.PageBreak.Option));

                OnCsvHeaderChanged(CsvHeaderOptions.SingleOrDefault(c => c.Option == tempModel.CsvConfigOption.Header.Option));
                OnGroupSymbolChanged(CsvGroupSymbolOptions.SingleOrDefault(c => c.Option == tempModel.CsvConfigOption.GroupSymbol.Option));
                OnSeparatorChanged(CsvDelimiterOptions.SingleOrDefault(c => c.Option == tempModel.CsvConfigOption.Delimiter.Option));
                OnDelimiterTextChanged(tempModel.CsvConfigOption.DelimiterSymbol);

                IsCompanySelectedAll = tempModel.Companies.Any(_ => _.IsSelectedAll);

                isFilterApply = false;
                await InvokeAsync(StateHasChanged);
            }
        }
    }

    #endregion

    #region Grid

    private void GenrateGrid()
    {
        try
        {
            List<TkdGridLy> tkdGridLies = GridLayoutService.GetGridLayout(GetCurrentUserInfo.SyainCdSeq, filterConditionFormName, SubContractorStatusGridHeaderNameConstants.GridName).Result;
            RenderGridBySavedLayout(tkdGridLies);
        }
        catch (Exception ex)
        {
            errorModalService.ShowErrorPopup("Error", ex.GetOriginalException()?.Message);
        }
    }

    private void RenderGridBySavedLayout(List<TkdGridLy> gridlayouts)
    {
        headerTemplate.Rows = new List<RowHeaderTemplate>();
        headerTemplate.StickyCount = 1;
        BodyTemplate bodyTemplate = new BodyTemplate();
        bodyTemplate.Rows = new List<RowBodyTemplate>();

        for (int i = 0; i < 3; i++)
        {
            headerTemplate.Rows.Add(new RowHeaderTemplate());
            bodyTemplate.Rows.Add(new RowBodyTemplate());
        }
        bodyTemplate.Rows.Add(new RowBodyTemplate());
        for (int i = 0; i < 3; i++)
        {
            headerTemplate.Rows[i].Columns = new List<ColumnHeaderTemplate>();
            bodyTemplate.Rows[i].Columns = new List<ColumnBodyTemplate>();
        }
        bodyTemplate.Rows[3].Columns = new List<ColumnBodyTemplate>();

        int CurrentIndex = 0;

        while (true)
        {
            // No
            if ((gridlayouts.Count == 0 && CurrentIndex == 0) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.NoItemNm))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["No"], RowSpan = 3, CodeName = SubContractorStatusGridHeaderNameConstants.NoItemNm, Width = gridlayouts.Count == 0 ? 50 : gridlayouts[CurrentIndex].Width });

                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.No), RowSpan = 4, AlignCol = AlignColEnum.Center, CustomCss = "align-top" });

            }
            //運行全日程
            if ((gridlayouts.Count == 0 && CurrentIndex == 1) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.AllServiceSchedule))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["AllServiceSchedule"], RowSpan = 3, CodeName = SubContractorStatusGridHeaderNameConstants.AllServiceSchedule, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.HaiSYmd), RowSpan = 2, AlignCol = AlignColEnum.Center });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TouYmd), RowSpan = 2, AlignCol = AlignColEnum.Center });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Center,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.HaiSYmd },
                            new List<string> { model.TouYmd }
                        }
                    }
                });
            }
            //得意先, 担当, 電話
            if ((gridlayouts.Count == 0 && CurrentIndex == 2) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.Tokui))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["Tokui"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.Tokui, Width = gridlayouts.Count == 0 ? 200 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["Staff"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.Staff, Width = gridlayouts.Count == 0 ? 200 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["Tel"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.Tel, Width = gridlayouts.Count == 0 ? 200 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TokuiNm), RowSpan = 1, AlignCol = AlignColEnum.Left });
                //bodyTemplate.Rows[1].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SitenNm), RowSpan = 1, AlignCol = AlignColEnum.Left });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TokuiTanNm), RowSpan = 1, AlignCol = AlignColEnum.Left });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TokuiTel), RowSpan = 1, AlignCol = AlignColEnum.Left });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Left,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.TokuiNm } ,
                            new List<string> { model.SitenNm } ,
                            new List<string> { model.TokuiTanNm } ,
                            new List<string> { model.TokuiTel }
                        }
                    }
                });
            }
            //団体名, 行き先名
            if ((gridlayouts.Count == 0 && CurrentIndex == 2) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.DanTaNm))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["DanTaNm"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.DanTaNm, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["IkNm"], RowSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.IkNm, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.DanTaNm), RowSpan = 2, AlignCol = AlignColEnum.Left });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.IkNm), RowSpan = 2, AlignCol = AlignColEnum.Left });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Left,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.DanTaNm } ,
                            new List<string> { model.IkNm } ,
                        }
                    }
                });
            }
            //総台数
            if ((gridlayouts.Count == 0 && CurrentIndex == 3) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.SumDai))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["SumDai"], RowSpan = 3, CodeName = SubContractorStatusGridHeaderNameConstants.SumDai, Width = gridlayouts.Count == 0 ? 70 : gridlayouts[CurrentIndex].Width });

                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TotalNumber), RowSpan = 4, AlignCol = AlignColEnum.Right, CustomCss = "align-top" });
            }
            //運賃, 消費税, 手数料
            if ((gridlayouts.Count == 0 && CurrentIndex == 4) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.SyaRyoUnc))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["SyaRyoUnc"], RowSpan = 1, ColSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.SyaRyoUnc, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["SyaRyoSyo"], RowSpan = 1, ColSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.Zeiritsu, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["SyaRyoTes"], RowSpan = 1, ColSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.SyaRyoSyo, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SumSyaRyoUnc), RowSpan = 2, ColSpan = 2, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.Zeiritsu), ColSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SumZeiRui), ColSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TesuRitu), ColSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SumTesuRyoG), ColSpan = 1, AlignCol = AlignColEnum.Right });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    ColSpan = 2,
                    AlignCol = AlignColEnum.Left,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { "", model.SumSyaRyoUnc } ,
                            new List<string> { model.Zeiritsu, model.SumZeiRui } ,
                            new List<string> {  model.TesuRitu, model.SumTesuRyoG } ,
                            new List<string> { "", "" }
                        }
                    }
                });
            }
            //ガイド料, 消費税, 手数料
            if ((gridlayouts.Count == 0 && CurrentIndex == 5) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.FutTumGuiKin))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["FutTumGuiKin"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.FutTumGuiKin, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["FutTumGuiTax"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.FutTumGuiTax, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["FutTumGuiTes"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.FutTumGuiTes, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SumGuideFee), RowSpan = 2, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SumGuideTax), RowSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.SumUnitGuiderFee), RowSpan = 1, AlignCol = AlignColEnum.Right });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Right,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.SumGuideFee } ,
                            new List<string> { model.SumGuideTax } ,
                            new List<string> { model.SumUnitGuiderFee } ,
                        }
                    }
                });
            }
            //付帯料, 消費税, 手数料
            if ((gridlayouts.Count == 0 && CurrentIndex == 6) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.FutTumKin))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["FutTumKin"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.FutTumKin, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["FutTumTax"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.FutTumTax, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["FutTumTes"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.FutTumTes, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.IncidentalFee), RowSpan = 2, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.IncidentalTax), RowSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.IncidentalCharge), RowSpan = 1, AlignCol = AlignColEnum.Right });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Right,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.IncidentalFee } ,
                            new List<string> { model.IncidentalTax } ,
                            new List<string> { model.IncidentalCharge } ,
                        }
                    }
                });
            }
            //傭車先
            if ((gridlayouts.Count == 0 && CurrentIndex == 7) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.CarDestination))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["CarDestination"], RowSpan = 3, CodeName = SubContractorStatusGridHeaderNameConstants.CarDestination, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouSkTokuiNm), RowSpan = 2, AlignCol = AlignColEnum.Left });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouStSitenNm), RowSpan = 2, AlignCol = AlignColEnum.Left });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Left,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.YouSkTokuiNm } ,
                            new List<string> { model.YouStSitenNm } ,
                        }
                    }
                });
            }
            //傭車先
            if ((gridlayouts.Count == 0 && CurrentIndex == 8) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.Gyosya))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["Gyosya"], RowSpan = 3, CodeName = SubContractorStatusGridHeaderNameConstants.Gyosya, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.GoSyas), RowSpan = 4, AlignCol = AlignColEnum.Right, CustomTextFormatDelegate = KoboGridHelper.BreakListBusScheduleInfoNo, CustomCss = "text-preline" });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { RowSpan = 4, AlignCol = AlignColEnum.Right, Control = new TableControl<SubContractorStatusSearchResultData> { TableValue = GetBusNumRentInfo } });
            }
            //配車・接続, 到着・接続
            if ((gridlayouts.Count == 0 && CurrentIndex == 9) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.HaiSInfo))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["HaiSInfo"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.HaiSInfo, Width = gridlayouts.Count == 0 ? 410 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["TouChInfo"], RowSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.TouChInfo, Width = gridlayouts.Count == 0 ? 410 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.BusScheduleInfos), RowSpan = 4, AlignCol = AlignColEnum.Left, CustomTextFormatDelegate = KoboGridHelper.BreakListBusScheduleInfo, CustomCss = "text-preline" });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { RowSpan = 4, AlignCol = AlignColEnum.Left, Control = new TableControl<SubContractorStatusSearchResultData> { TableValue = GetBusScheduleInfo } });
            }
            //傭車運賃, 消費税, 手数料
            if ((gridlayouts.Count == 0 && CurrentIndex == 10) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.YoushaUnc))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YoushaUnc"], ColSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.YoushaUnc, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YoushaSyo"], ColSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.YouZeiritsu, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YoushaTes"], ColSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.YouTesuRitu, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { ColSpan = 2, RowSpan = 4, AlignCol = AlignColEnum.Right, Control = new TableControl<SubContractorStatusSearchResultData> { TableValue = GetTaxFeeDisplay } });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TaxFeeInfos), ColSpan = 1, RowSpan = 4, AlignCol = AlignColEnum.Right, CustomTextFormatDelegate = KoboGridHelper.BreakListTaxRateInfo, CustomCss = "text-preline" });
                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.TaxFeeInfos), ColSpan = 1, RowSpan = 4, AlignCol = AlignColEnum.Right, CustomTextFormatDelegate = KoboGridHelper.BreakListTaxFeeInfo, CustomCss = "text-preline" });
            }
            //傭車ガイド料, 消費税, 手数料
            if ((gridlayouts.Count == 0 && CurrentIndex == 11) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.YouFutTumGuiKin))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YouFutTumGuiKin"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YouFutTumGuiKin, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YouFutTumGuiTax"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YouFutTumGuiTax, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YouFutTumGuiTes"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YouFutTumGuiTes, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouFutTumGuiKin), RowSpan = 2, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouFutTumGuiTax), RowSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouFutTumGuiTes), RowSpan = 1, AlignCol = AlignColEnum.Right });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Right,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.YouFutTumGuiKin } ,
                            new List<string> { model.YouFutTumGuiTax } ,
                            new List<string> { model.YouFutTumGuiTes } ,
                        }
                    }
                });
            }
            //傭車付帯料, 消費税, 手数料
            if ((gridlayouts.Count == 0 && CurrentIndex == 12) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.YouFutTumKin))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YouFutTumKin"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YouFutTumKin, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YouFutTumTax"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YouFutTumTax, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YouFutTumTes"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YouFutTumTes, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouFutTumKin), RowSpan = 2, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouFutTumTax), RowSpan = 1, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YouFutTumTes), RowSpan = 1, AlignCol = AlignColEnum.Right });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Right,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.YouFutTumKin } ,
                            new List<string> { model.YouFutTumTax } ,
                            new List<string> { model.YouFutTumTes } ,
                        }
                    }
                });
            }
            //乗車人員, プラス人員
            if ((gridlayouts.Count == 0 && CurrentIndex == 13) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.JyoSyaJin))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["JyoSyaJin"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.JyoSyaJin, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["PlusJin"], RowSpan = 2, CodeName = SubContractorStatusGridHeaderNameConstants.PlusJin, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.JyoSyaJin), RowSpan = 2, AlignCol = AlignColEnum.Right });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.PlusJin), RowSpan = 2, AlignCol = AlignColEnum.Right });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Right,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {

                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.JyoSyaJin } ,
                            new List<string> { model.PlusJin } ,
                        }
                    }
                });
            }
            //受付営業所, 予約区分, 受付日 / 番号
            if ((gridlayouts.Count == 0 && CurrentIndex == 14) || (gridlayouts.Count != 0 && gridlayouts[CurrentIndex].ItemNm == SubContractorStatusGridHeaderNameConstants.UkeEigyosRyaku))
            {
                headerTemplate.Rows[0].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["UkeEigyosRyaku"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.UkeEigyosRyaku, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[1].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["YoyaKbn"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.YoyaKbn, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });
                headerTemplate.Rows[2].Columns.Add(new ColumnHeaderTemplate() { ColName = Lang["UkeInfo"], RowSpan = 1, CodeName = SubContractorStatusGridHeaderNameConstants.UkeYmd, Width = gridlayouts.Count == 0 ? 150 : gridlayouts[CurrentIndex].Width });

                //bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.UkeEigyosRyaku), RowSpan = 1, AlignCol = AlignColEnum.Center });
                //bodyTemplate.Rows[1].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.YoyaKbn), ColSpan = 1, AlignCol = AlignColEnum.Center });
                //bodyTemplate.Rows[2].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.UkeYmd), ColSpan = 1, AlignCol = AlignColEnum.Center });
                //bodyTemplate.Rows[3].Columns.Add(new ColumnBodyTemplate() { DisplayFieldName = nameof(SubContractorStatusSearchResultData.UkeCd), ColSpan = 1, AlignCol = AlignColEnum.Center });
                bodyTemplate.Rows[0].Columns.Add(new ColumnBodyTemplate()
                {
                    RowSpan = 4,
                    AlignCol = AlignColEnum.Center,
                    CustomCss = "align-top",
                    Control = new TableControl<SubContractorStatusSearchResultData>
                    {
                        TableValue = (model) => new List<List<string>> {
                            new List<string> { model.UkeEigyosRyaku } ,
                            new List<string> { model.YoyaKbn } ,
                            new List<string> { model.UkeYmd } ,
                            new List<string> { model.UkeCd } ,
                        }
                    }
                });

                if (gridlayouts.Count == 0)
                {
                    break;
                }
            }

            CurrentIndex++;
            if (gridlayouts.Count != 0 && CurrentIndex >= gridlayouts.Count)
            {
                break;
            }
        }
        Header = headerTemplate;
        Body = bodyTemplate;
    }

    public async void ReOrderTable()
    {
        await LoadingService.ShowAsync();
        var headerColumns = Header.Rows.Count > 0 ? Header.Rows[0].Columns : new List<ColumnHeaderTemplate>();
        List<TkdGridLy> gridLayouts = new List<TkdGridLy>();

        for (int i = 0; i < headerColumns.Count; i++)
        {
            string itemName = headerColumns[i].CodeName;
            gridLayouts.Add(new TkdGridLy()
            {
                DspNo = i,
                FormNm = filterConditionFormName,
                FrozenCol = 0,
                GridNm = SubContractorStatusGridHeaderNameConstants.GridName,
                ItemNm = itemName,
                SyainCdSeq = GetCurrentUserInfo.SyainCdSeq,
                UpdPrgId = filterConditionFormName,
                UpdSyainCd = GetCurrentUserInfo.SyainCdSeq,
                UpdYmd = DateTime.Now.ToString("yyyyMMdd"),
                UpdTime = DateTime.Now.ToString("HHmmss"),
                Width = headerColumns[i].Width
            });
        }
        var isSaved = await GridLayoutService.SaveGridLayout(gridLayouts);
        await LoadingService.HideAsync();
        await InvokeAsync(StateHasChanged);
    }

    public async void InitGridLayout()
    {

        await LoadingService.ShowAsync();
        await Task.Run(() =>
        {
            List<TkdGridLy> tkdGridLies = new List<TkdGridLy>();
            RenderGridBySavedLayout(tkdGridLies);
            DeleteSavedGridLayout();
            InvokeAsync(StateHasChanged).Wait();
        });
        await LoadingService.HideAsync();
    }

    private void DeleteSavedGridLayout()
    {
        var isDeleted = GridLayoutService.DeleteSavedGridLayout(GetCurrentUserInfo.SyainCdSeq, filterConditionFormName, StatusConfirmationGridHeaderNameConstants.GridName).Result;
    }


    private async Task OnRowClicked(RowClickEventArgs<SubContractorStatusSearchResultData> args)
    {
        var mouseLocation = new Point { X = args.Event.ClientX, Y = args.Event.ClientY };

        if (args.Event.Detail > 1)
        {
            await blazorContextMenuService.ShowMenu("Menu1", (int)mouseLocation.X, (int)mouseLocation.Y);
        }
        else
        {
            await blazorContextMenuService.HideMenu("Menu1");

        }
        StateHasChanged();
    }

    private async void OnPaginationChanged(int page)
    {
        //Because in Paination component page start at 0
        CurrentPage = page + 1;

        isSearching = true;
        StateHasChanged();

        data.BookingTypes = BookingTypes.Where(_ => _ != null).ToList();
        PagedResultData = await SubContractorStatusReportService.SearchSubContractorStatusSearchPaged(data, new ClaimModel().TenantID, CurrentPage, RecordsPerPage);
        data.BookingTypes = null;

        TotalItems = PagedResultData.TotalRecord;

        if (PagedResultData.PageData.Any())
        {

        }
        else
        {
            notifyNotFound = true;
        }

        isSearching = false;
        StateHasChanged();
    }

    private void HandleItemPerPageChange(byte newItemPerPage)
    {
        RecordsPerPage = newItemPerPage;
        StateHasChanged();
    }

    #endregion

    #region Helper
    private void OnValidationStateChanged(object sender, ValidationStateChangedEventArgs args)
    {
        isExportable = !((EditContext)sender).GetValidationMessages().Any();

        cmbCompanyIsError = ((EditContext)sender).GetValidationMessages().Any(_ => _ == Constants.ErrorMessage.SCS_CompanyIsRequired);
    }

    public IReadOnlyList<IReadOnlyList<string>> GetTaxFeeDisplay(SubContractorStatusSearchResultData data)
    {
        List<TaxFeeInfo> info = data.TaxFeeInfos;
        var tbl = new List<List<string>>();

        foreach (var row in info)
        {
            tbl.Add(new List<string> { "\t", row.YoushaUnc });
            tbl.Add(new List<string> { row.YouZeiritsu, row.YoushaSyo });
            tbl.Add(new List<string> { row.YouTesuRitu, row.YoushaTes });
            tbl.Add(new List<string> { "\t", "\t" });
            tbl.Add(new List<string> { "\t", "\t" });
        }
        tbl.RemoveAt(tbl.Count - 1);
        return tbl;
    }

    public IReadOnlyList<IReadOnlyList<string>> GetBusScheduleInfo(SubContractorStatusSearchResultData data)
    {
        List<BusScheduleInfo> info = data.BusScheduleInfos;
        var tbl = new List<List<string>>();

        foreach (var row in info)
        {
            tbl.Add(new List<string> { row.VehicleDispatch });
            tbl.Add(new List<string> { row.VehicleDispatchOther });
            tbl.Add(new List<string> { row.ArrivalConnection });
            tbl.Add(new List<string> { row.ArrivalConnectionOther });
            tbl.Add(new List<string> { "" });
        }

        tbl.RemoveAt(tbl.Count - 1);

        return tbl;
    }

    public IReadOnlyList<IReadOnlyList<string>> GetBusNumRentInfo(SubContractorStatusSearchResultData data)
    {
        List<string> info = data.GoSyas;
        var tbl = new List<List<string>>();

        foreach (var row in info)
        {
            tbl.Add(new List<string> { "" });
            tbl.Add(new List<string> { "" });
            tbl.Add(new List<string> { row.Trim() });
            tbl.Add(new List<string> { "" });
            tbl.Add(new List<string> { "" });
        }

        tbl.RemoveAt(tbl.Count - 1);

        return tbl;
    }

    async Task OnModelChanged(string propertyName, dynamic val, bool isFrom = true, bool isSelect = true)
    {
        if (!isFilterApply)
        {
            if (val != null && val.IsSelect)
                isTabChange = false;

            if (!isTabChange)
            {
                var propertyFromInfo = data.GetType().GetProperty(propertyName);
                propertyFromInfo.SetValue(data, val);


                if (isFrom)
                {
                    if ((propertyName == nameof(data.SelectedGyosyaFrom) && (data?.SelectedGyosyaFrom?.IsSelect ?? false)) ||
                        (propertyName == nameof(data.SelectedTokiskFrom) && (data?.SelectedTokiskFrom?.IsSelect ?? false)) ||
                        (propertyName == nameof(data.SelectedTokiStFrom) && (data?.SelectedTokiStFrom?.IsSelect ?? false)) ||
                        (propertyName == nameof(data.RegistrationTypeFrom) && (data?.RegistrationTypeFrom?.IsSelect ?? false)))
                        await OnButtonSearchClicked();
                }
                else
                {
                    if ((propertyName == nameof(data.SelectedGyosyaTo) && (data?.SelectedGyosyaTo?.IsSelect ?? false)) ||
                        (propertyName == nameof(data.SelectedTokiskTo) && (data?.SelectedTokiskTo?.IsSelect ?? false)) ||
                        (propertyName == nameof(data.SelectedTokiStTo) && (data?.SelectedTokiStTo?.IsSelect ?? false)) ||
                        (propertyName == nameof(data.RegistrationTypeTo) && (data?.RegistrationTypeTo?.IsSelect ?? false)))
                        await OnButtonSearchClicked();
                }
            }
        }
        StateHasChanged();
    }
    #endregion

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IErrorHandlerService errorModalService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IBlazorContextMenuService blazorContextMenuService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private CustomHttpClient Http { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppSettingsService AppSettingsService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Microsoft.AspNetCore.Hosting.IWebHostEnvironment HostingEnvironment { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime IJSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ISubContractorStatusReportService SubContractorStatusReportService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IFilterCondition FilterServices { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStaffListService StaffService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IGridLayoutService GridLayoutService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ILoadingService LoadingService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ITPM_EigyosDataListService BranchDataService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ITPM_CompnyDataListService CompanyDataService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ITPM_YoyKbnDataListService TPM_YoyKbnDataService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ICustomerListService CustomerService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<SubContractorStatus> Lang { get; set; }
    }
}
#pragma warning restore 1591
