import"./esm-chunk-eaca7b99.js";import{B as t,V as e,x as o,t as n,ai as i,A as r,a9 as s,D as l,U as u}from"./esm-chunk-64a12c37.js";import{D as c,R as a}from"./esm-chunk-0778bac7.js";import{T as d}from"./esm-chunk-c94f8125.js";import{K as f}from"./esm-chunk-6d4715b2.js";import"./esm-chunk-95f069f9.js";import{ScrollToFocusedItem as m,ScrollToSelectedItem as p}from"./esm-grid-c0bbd2da.js";import{show as v}from"./esm-popup-utils-a5d257f0.js";import{InitFocusHidingEvents as h}from"./esm-focus-utils-cbe17b19.js";const g={Popup:0,Modal:1},b=1,y=2;function w(e){return(e=t(e)).querySelector("div.dxbs-dm.dropdown-menu")}function E(e,o,n){return new Promise((function(i,r){var s=w(e);return(s=t(s))?(D(e,s,o),n?m(s):p(s),i()):i()}))}function x(o){return new Promise((function(n,i){var r=w(o);if(!(r=t(r)))return n();let s=r.offsetParent,l=s.getBoundingClientRect(),u=o.getBoundingClientRect(),c=r.getBoundingClientRect(),a=o.offsetHeight,d=document.body.clientWidth,f=r.offsetWidth,m=s.scrollTop;e((function(){c.top<u.top?(r.style.top="unset",r.style.bottom=l.bottom-u.bottom+a-m+"px"):(r.style.bottom="unset",r.style.top=u.top-l.top+a+m+"px");let t=u.left-l.left;return l.left+t+f>=d&&(t=d-f-l.left),r.style.left=t+"px",n()}))}))}function D(t,o,n){let i,r=o.offsetParent,s=r.getBoundingClientRect(),l=t.getBoundingClientRect(),u=l.left-s.left,c=l.top-s.top,a=s.bottom-l.bottom,d=window.getComputedStyle(o),f=o.offsetHeight+parseFloat(d.marginTop)+parseFloat(d.marginBottom)+8;switch(n){case y:i=!0,s.top+(c-f)<=0&&s.top+c+t.offsetHeight+f+pageYOffset<=Math.max(document.body.scrollHeight,window.innerHeight)&&(i=!1);break;case b:default:i=!1,s.bottom-(a-f)>=window.innerHeight&&s.top+c-f+pageYOffset>=0&&(i=!0)}e((function(){i?(o.style.top="unset",o.style.bottom=a+t.offsetHeight-r.scrollTop+"px"):(o.style.top=c+t.offsetHeight+r.scrollTop+"px",o.style.bottom="unset");let e=u;s.left+e+o.offsetWidth>=document.body.clientWidth&&(e=document.body.clientWidth-o.offsetWidth-s.left),o.style.left=e+"px",o.style.visibility=""}))}const C=[{value:0,text:""},{value:1,text:"above"},{value:2,text:"below"},{value:4,text:"top-sides"},{value:8,text:"bottom-sides"},{value:16,text:"outside-left"},{value:32,text:"outside-right"},{value:64,text:"left-sides"},{value:128,text:"right-sides"}];function H(t,e,o){for(var n=t.target;n;){if(n===e)return!1;n=n.parentElement}o&&o()}function L(t){return"hidden"!==t.style.visibility}const T="a[href], input:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex='-1'])";function M(t,e){if(n(t.srcElement,"modal-header"))return!0;var o=n(t.srcElement,"column-chooser-elements-container"),i=n(o,"modal-body");if(!o||!i)return!1;if(i.clientHeight>=o.clientHeight)return!0;var r=t.touches[0].pageY-e.touches[0].pageY,s=function(t){return t.getBoundingClientRect().top},l=o.querySelector(".column-chooser-element-container");if(l&&s(l)===s(i)&&r>=0&&t.cancelable)return!0;var u=function(t){return Math.round(t.getBoundingClientRect().bottom)},c=o.querySelector(".column-chooser-element-container:last-child");return!!(c&&u(c)===u(i)&&r<=0&&t.cancelable)||void 0}function P(t,e,o){if(o===g.Modal){var i=t.getBoundingClientRect(),r=e.getBoundingClientRect(),s=n(t,"dxbs-gridview"),l=s&&s.querySelector("thead");if(l){var u=l.getBoundingClientRect(),c=(u||i).bottom;return c>.5*e.clientHeight?c-i.top<.5*e.clientHeight?c-r.top-.5*e.clientHeight:i.top-r.top-2:void 0}}}const k={Init:function(e,n,i,r){if(e=t(e),n=t(n),i=t(i),e){if(c(e),i){var u=function(t){return H(t,e,(function(){s(e)||c(e);var t=document.activeElement===n,o=i&&L(i);(t||o)&&r.invokeMethodAsync("OnDropDownLostFocus",n.value)}))};o(document,d.touchMouseDownEventName,u),a(e,(function(){l(document,d.touchMouseDownEventName,u)}))}return Promise.resolve("ok")}},Dispose:function(e){return(e=t(e))&&c(e),Promise.resolve("ok")},ShowAdaptiveDropdown:function(o,s,l,c,a){o=t(o);var m=n(o,l);if(m){m.querySelector("."+c);var p=document.documentElement,b=document.documentElement.style.overflow,y=document.body.style.overflow,w=document.body.scroll,E=s.dialogType,H=s.alignment,L=E===g.Modal;E===g.Popup&&(0==H?D(m,o,s.dropDownDirection):v(o,m,function(t){var e="";return C.forEach(o=>{0!=(o.value&t)&&(e&&(e+=" "),e+=o.text)}),e}(H)));var k=!1;return p.addEventListener(d.touchMouseDownEventName,B),o.addEventListener("keydown",(function(t){t.keyCode===f.Esc&&R()})),o.addEventListener("focusout",(function(t){var e,n,i,r;k||(null===t.relatedTarget||o.contains(t.relatedTarget)?null===t.relatedTarget&&p.addEventListener("focusin",N):void((e=o.compareDocumentPosition(t.relatedTarget))&Node.DOCUMENT_POSITION_PRECEDING?(i=o,r=i.querySelectorAll(T),n=r[r.length-1],void(n&&n.focus())):e&Node.DOCUMENT_POSITION_FOLLOWING&&S()))})),function(t,e,o,n){t&&e.addEventListener("touchmove",t=>{t.srcElement===e&&t.preventDefault()});if(n===g.Modal){var i=null;o.addEventListener("touchstart",t=>{i=t}),o.addEventListener("touchmove",t=>{M(t,i)&&t.preventDefault(),i=t})}}(L,o,m,E),i(o).then(()=>{O(),o=null}),q(E,!0),E===g.Popup?(e((function(){s.showFocus||(r(o,"dxbs-focus-hidden"),h(o)),S()})),0==H&&window.addEventListener("resize",W)):(window.addEventListener("resize",j),j()),Promise.resolve()}function B(t){(!o.contains(t.srcElement)||E===g.Modal&&o===t.srcElement)&&R()}function N(t){p.removeEventListener("focusin",N),null===t.relatedTarget&&t.target&&o&&o.contains(t.target)&&t.target.focus()}function R(){k||(k=!0,setTimeout((function(){O(),a.invokeMethodAsync("CloseDialog")}),200))}function O(){p.removeEventListener(d.touchMouseDownEventName,B),window.removeEventListener("resize",j),window.removeEventListener("resize",W),q(E,!1)}function S(){var t=o.querySelector(T);t&&t.focus()}function j(){if(n(o,"modal-dialog-owner")){var t=o.firstElementChild.classList,e=P(m,p,E),i=p.clientHeight>p.clientWidth?"topVertical":"topHorizontal";u((function(){t.contains("topVertical")||t.contains("topHorizontal")?t.remove("transition"):t.add("transition"),e&&(p.scrollTop=e),t.remove("topVertical","topHorizontal"),t.add(i)}))}}function W(){x(m)}function q(t,e){var o,n,i;t===g.Modal&&(e?(o="hidden",n="hidden",i="no"):(o=b,n=y,i=w),document.documentElement.style.overflow=o,document.body.style.overflow=n,document.body.scroll=i)}},UpdateGridDropDown:E,AdjustDropDownPosition:x};export default k;export{x as AdjustDropDownPosition,g as DialogType,w as GetDropDownElement,L as IsDropDownVisible,H as OnOutsideClick,P as ScrollDropDown,D as SetPositionOfDropDown,M as ShouldPreventTouchMove,E as UpdateGridDropDown};
