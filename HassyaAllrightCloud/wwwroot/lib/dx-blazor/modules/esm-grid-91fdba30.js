import{B as e}from"./esm-chunk-f9104efc.js";import{AttachEventToElement as t,DetachEventFromElement as o,findParentBySelector as l,getDocumentScrollTop as n,getDocumentScrollLeft as r,elementIsInDOM as i,QuerySelectorFromRoot as a,EnsureElement as s,GetLeftRightBordersAndPaddingsSummaryValue as c}from"./esm-dom-utils-d4fe413b.js";import{D as u,R as d}from"./esm-chunk-6ca2c4f2.js";import{T as p}from"./esm-chunk-2f760454.js";import"./esm-chunk-710198b6.js";import{G as f}from"./esm-chunk-95f069f9.js";var g={GridSelectedRowCell:".dxbs-table td.table-active",ListBoxSelectedItem:".dropdown-item.active"};function h(e){return"[data-dxdg-draggable-id="+e+"]"}function m(e,t,o){var l,n,r;l=e,n=y(t,"clientX")-o.left,r=y(t,"clientY")-o.top,void(l.style.transform=["translate(",Math.round(n),"px, ",Math.round(r),"px)"].join(""))}var v={GroupPanelHead:"gph",ColumnHead:"ch"};function y(e,t){return void 0!==e[t]?e[t]:void 0!==e.touches?e.touches[0][t]:0}function H(i,a,s){var c=y(i,"clientX"),u=y(i,"clientY"),d=i.target,f=!1,g=function(e){var i=Math.abs(c-y(e,"clientX"))>10,g=Math.abs(u-y(e,"clientY"))>10;return(i||g)&&(f=!0,H(),function(e,i,a,s){var c=h(a),u=l(i,c);if(!u)return;var d=u.dataset.dxdgDraggable.split("|"),f=parseInt(d[0]),g=parseInt(d[1]),H=d[3],b="True"===d[4],w=r(),I=n(),R={left:0,top:0},N={columnVisibleIndex:f,groupVisibleIndex:g,columnHeadType:H,canBeGrouped:b},q=function(e,t){for(var o=[],l=h(t),n=document.querySelectorAll(l),r=!1,i=!1,a=0;a<n.length;a++){var s=n[a],c=s.getBoundingClientRect(),u=s.dataset.dxdgDraggable.split("|"),d=parseInt(u[0]),p=parseInt(u[1]),f="True"===u[2],g=u[3];g==v.GroupPanelHead?r=!0:g==v.ColumnHead&&(i=!0),f&&o.push(new T(s,c.left,c.top,c.bottom,d,p,g,!0,!1)),o.push(new T(s,c.right,c.top,c.bottom,d,p,g,!1,!1))}if(r||i){if(!r){var m=document.querySelector("[data-dxdg-drag-group-panel="+t+"]");if(m){var c=m.getBoundingClientRect();o.push(new T(m,c.left,c.top,c.bottom,-1,0,v.GroupPanelHead,!1,!0,!0))}}if(!i){var y=document.querySelector("[data-dxdg-drag-head-row="+t+"]");if(y){var c=y.getBoundingClientRect();o.push(new T(y,c.right,c.top,c.bottom,0,-1,v.ColumnHead,!1,!0,!0))}}}return o}(0,a),V=function(e,t){var o=e.cloneNode(!0),l=e.getBoundingClientRect(),n={left:y(t,"clientX")-l.left,top:y(t,"clientY")-l.top};if("DIV"!=o.tagName){var r=document.createElement("DIV"),i=window.getComputedStyle(e);r.innerHTML=o.innerHTML,r.className="card "+e.className,r.style.width=e.offsetWidth+"px",r.style.height=e.offsetHeight+"px",r.style.paddingTop=i.paddingTop,r.style.paddingBottom=i.paddingBottom,r.style.paddingLeft=i.paddingLeft,r.style.paddingRight=i.paddingRight,o=r}else o.style.width=e.offsetWidth+"px",o.style.height=e.offsetHeight+"px";o.className=o.className+" dx-dragging-state",document.body.appendChild(o);var a=o.getBoundingClientRect();return{dragElement:o,offsetFromMouse:{left:a.left+n.left,top:a.top+n.top}}}(u,e),M=V.dragElement,B=V.offsetFromMouse;m(M,e,B);var C=!0,D=null,E=function(e){C&&(M.style.visibility="visible",C=!1);var t={left:B.left+R.left,top:B.top+R.top};return m(M,e,t),D=function(e,t,o,l,i){!function(e){for(var t=h(e),o=document.querySelectorAll("div."+x+t),l=0;l<o.length;l++){var n=o[l];n.parentNode.removeChild(n)}}(t);for(var a=null,s=[],c=y(l,"clientX"),u=y(l,"clientY"),d=0;d<e.length;d++){var p=e[d];if(!S(o,p)&&(p.columnHeadType!=v.GroupPanelHead||o.canBeGrouped)){var f=p.top+i.top<=u&&u<=p.bottom+i.top;if(f){if(p.wholeRowIsRarget){a=p;break}s.push({distance:Math.abs(Math.abs(p.x+i.left)-Math.abs(c)),target:p})}}}if(null==a){var g=1e6;for(var d in s)g>s[d].distance&&(g=s[d].distance,a=s[d].target)}null!=a&&!function(e,t){var o=document.createElement("DIV");o.className=x,o.dataset.dxdgDraggableId=t,o.style.top=e.top+(e.docScrollTop-n())+n()-1-1+"px",o.style.height=e.bottom-e.top+2+"px",o.style.left=e.x+(e.docScrollLeft-r())+r()+"px",o.innerHTML=["<span class='oi oi-arrow-bottom' aria-hidden='true'></span>","<div style='height:",o.style.height,"'></div>","<span class='oi oi-arrow-top' aria-hidden='true'></span>"].join(""),document.body.appendChild(o),e.mark=o}(a,t);return a}(q,a,N,e,R),e.preventDefault(),!1},L=function(){if(D){var e=N.columnHeadType==v.GroupPanelHead?N.groupVisibleIndex:N.columnVisibleIndex,t=D.columnHeadType==v.GroupPanelHead?D.groupVisibleIndex:D.columnVisibleIndex;s.invokeMethodAsync("OnGridColumnHeadDragNDrop",e,N.columnHeadType,t,D.columnHeadType,D.insertBefore),D.mark.parentNode.removeChild(D.mark)}o(document,p.touchMouseMoveEventName,E),o(document,p.touchMouseUpEventName,L),o(window,"scroll",G),M.parentNode.removeChild(M)},G=function(){R={left:w-r(),top:I-n()}};t(document,p.touchMouseMoveEventName,E),t(document,p.touchMouseUpEventName,L),t(window,"scroll",G)}(e,d,a,s)),e.preventDefault(),!1},H=function(){o(document,p.touchMouseMoveEventName,g),o(document,p.touchMouseUpEventName,H),!f&&d&&e.WebKitTouchUI&&d.click()};return t(document,p.touchMouseMoveEventName,g),t(document,p.touchMouseUpEventName,H),i.preventDefault(),!1}function T(e,t,o,l,i,a,s,c,u){this.element=e,this.x=t,this.top=o,this.bottom=l,this.columnVisibleIndex=i,this.groupVisibleIndex=a,this.columnHeadType=s,this.insertBefore=c,this.wholeRowIsRarget=u,this.docScrollTop=n(),this.docScrollLeft=r()}function S(e,t){function o(e,t){return t.groupVisibleIndex==e.groupVisibleIndex||t.groupVisibleIndex==e.groupVisibleIndex-1&&!t.insertBefore}function l(e,t){return t.columnVisibleIndex==e.columnVisibleIndex||t.columnVisibleIndex==e.columnVisibleIndex-1&&!t.insertBefore}return!(t.columnHeadType!=e.columnHeadType||e.columnHeadType!=v.GroupPanelHead||!o(e,t))||(!(t.columnHeadType!=e.columnHeadType||e.columnHeadType!=v.ColumnHead||!l(e,t))||(!(e.columnHeadType!=v.GroupPanelHead||t.columnHeadType!=v.ColumnHead||-1==e.columnVisibleIndex||!l(e,t))||!(e.columnHeadType!=v.ColumnHead||t.columnHeadType!=v.GroupPanelHead||-1==e.groupVisibleIndex||!o(e,t))))}var x="dxgv-target-marks";var b=200;function w(e){if(i(e)){if(!(t=function(e){var t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){var o=t.querySelector(g.ListBoxSelectedItem);if(o)return o.parentNode}return null}(e)))var t=function(e){var t=null;a(e,function(o){t=e.querySelector("*"+o+" > *[id$='_LB']")}),t||a(e.parentNode,function(o){t=e.parentNode.querySelector("*"+o+" > *[id$='_LB']")});var o=t?t.querySelector(g.GridSelectedRowCell):null;return o?o.parentNode:null}(e);if(t){var o=e,l=o.scrollTop+o.clientHeight<t.offsetTop+t.offsetHeight;o.scrollTop>t.offsetTop&&(o.scrollTop=t.offsetTop),l&&(o.scrollTop=t.offsetTop-(o.clientHeight-t.offsetHeight))}}}function I(e,t,o,l,n,r){var i=e.target;R(e,t,o,i,l),i.dataset.InScrollRequest||(N(i),i.dataset.OnScrollTimerId=window.setTimeout(function(){!function(e,t,o,l,n,r,i){N(l);var a=!0;l.dataset.prevScrollTop?a=l.dataset.prevScrollTop!=l.scrollTop.toString():l.dataset.prevScrollTop=l.scrollTop;a&&o.isVirtualScrolling&&!function(e,t,o,l,n){var r=q(t),i=C(t,n),a=i.itemHeight,s=i.scrollTop,c=i.scrollBottom,u=i.scrollTopForRequest,d=i.scrollHeightForRequest,p=l.clientHeight>0&&c>o.offsetHeight+r.offsetHeight;(o.clientHeight>0&&s<o.offsetHeight||p)&&(t.dataset.InScrollRequest=!0,function(e,t,o,l){if(e.dxScrollCache){if(e.dxScrollCache.itemHeight===t&&e.dxScrollCache.scrollTopForRequest===o&&e.dxScrollCache.scrollHeightForRequest===l)return}else e.dxScrollCache={itemHeight:t,scrollTopForRequest:o,scrollHeightForRequest:l};e.invokeMethodAsync("OnGridVirtualScroll",t,o,l)}(e,a,u,d))}(t,l,r,i,!1);R(e,t,o,l,n)}(e,t,o,i,l,n,r)},b),window.setTimeout(function(){R(e,t,o,i,l)},0))}function R(e,t,o,l,n,r,i){o.isHorizontalScrolling&&(n.scrollLeft=l.scrollLeft)}function N(e){e.dataset.OnScrollTimerId&&(clearTimeout(e.dataset.OnScrollTimerId),delete e.dataset.OnScrollTimerId)}function q(e){var t=e.querySelector("table.dxbs-table"),o=e.parentNode.querySelector("div.dxbs-listbox > ul");return t||o}function V(e,t,o,l,n){var r=q(t),i=function(e,t){var o=M(e);return{itemHeight:o,spacerTop:t.VirtualScrollingOptions.ItemsAbove*o,spacerBelow:t.VirtualScrollingOptions.ItemsBelow*o}}(r,n);o.style.height=i.spacerTop+"px",l.style.height=i.spacerBelow+"px",function(e,t,o,l){if(e.clientHeight>t.offsetHeight)return;e.scrollTop<o.clientHeight&&(e.scrollTop=o.clientHeight+1);e.scrollTop+e.clientHeight>o.clientHeight+t.offsetHeight&&(e.scrollTop=o.clientHeight+t.offsetHeight-e.clientHeight-1)}(t,r,o)}function M(e){for(var t=function(e){var t=[];return e.dataset.tempUniqueId="tempUniqueId","TABLE"===e.tagName?t=e.parentNode.querySelectorAll("TABLE[data-temp-unique-id] > TBODY > TR"):"UL"===e.tagName&&(t=e.parentNode.querySelectorAll("ul[data-temp-unique-id] > li")),delete e.dataset.tempUniqueId,t}(e),o={},l=0;l<t.length;l++){var n=t[l];o[n.offsetHeight]=o[n.offsetHeight]?o[n.offsetHeight]+1:1}var r=0,i=0;for(var a in o)o[a]>i&&(i=o[a],r=a);return Number.parseInt(r)}function B(e){return null!==q(e)}function C(e,t){var o=300,l=300;t&&(o=0,l=0);var n=q(e),r=e.scrollTop-o;r<0&&(r=0);var i=e.scrollTop+e.clientHeight+l,a=r-o;a<0&&(a=0);var s=i-a+l;return{itemHeight:M(n),scrollTop:r,scrollBottom:i,scrollTopForRequest:a,scrollHeightForRequest:s}}function D(e,t){return(t.isVerticalScrolling||t.isVirtualScrolling)&&(e.clientHeight<e.scrollHeight||"scroll"==e.style.overflowY)}function E(e,l,n,r,i,a,g,m){if(null!==e){a=JSON.parse(a),e=s(e),u(e);var v=null,y=null,T=null,S=null;(l=s(l))&&(n=s(n),l.dataset.InScrollRequest=!0,a.isVirtualScrolling&&(r=s(r),i=s(i)),(a.isVirtualScrolling||a.isVerticalScrolling)&&function(e,t,o){if((o.isVerticalScrolling||o.isVirtualScrolling)&&t){var l=[t];if(D(e,o)){var n=f();if(17!==n||o.isHorizontalScrolling)for(var r=o.isHorizontalScrolling?"paddingRight":"marginRight",i=o.isHorizontalScrolling?"marginRight":"paddingRight",a=0,s=l.length;a<s;a++)l[a].style[r]="0",l[a].style[i]=n+"px";else e.style.paddingRight="",e.style.marginRight="",t.style.paddingRight="",t.style.marginRight=""}else e.style.paddingRight="0",e.style.marginRight="0",t.style.paddingRight="0",t.style.marginRight="0"}}(l,n,a),a.isVirtualScrolling&&(V(0,l,r,i,a),m&&w(l)),function(e){for(var t=e.querySelectorAll("th.dxbs-header-indent>button.invisible"),o=0,l=0;l<t.length;l++){var n=(r=t[l]).offsetWidth+c(r.parentNode);o<n&&(o=n)}for(l=0;l<t.length;l++){var r;(r=t[l]).parentNode.style.width=o+"px"}}(e),delete l.dataset.InScrollRequest,t(l,"scroll",v=function(e){return I(e,g,a,n,r,i)}),function(e){return e.isHorizontalScrolling||e.isVerticalScrolling}(a)&&((y=function(){!function(e,t,o,l,n,r){if(t){t.dataset.InScrollRequest=!0;var i=t.style.overflowX;t.style.overflowX="hidden",t.style.width="0"}if(o){var a=o.style.overflowX;o.style.overflowX="hidden",o.style.width="0"}var s=e.clientWidth;if(t&&(s&&(t.style.width=s+"px"),t.style.overflowX=i),o){var c=D(t,r)?f():0;s&&(o.style.width=s-c+"px"),o.style.overflowX=a}t&&delete t.dataset.InScrollRequest}(e,l,n,0,0,a)})(),t(window,"resize",y)));var x=null,b=null;if(a.isColumnDragEnabled){var R=e.dataset.dxdgId;if(R){var q=e.querySelector("th"+h(R));(x=q?q.parentNode:null)&&t(x,p.touchMouseDownEventName,T=function(e){return H(e,R,g)});var M=e.querySelector("div"+h(R));(b=M?M.parentNode:null)&&t(b,p.touchMouseDownEventName,S=function(e){return H(e,R,g)})}}return d(e,function(){v&&o(l,"scroll",v),y&&o(window,"resize",y),l&&N(l),T&&x&&o(x,p.touchMouseDownEventName,T),S&&b&&o(b,p.touchMouseDownEventName,S)}),Promise.resolve("ok")}}function L(e){return(e=s(e))&&u(e),Promise.resolve("ok")}const G={Init:E,Dispose:L};export default G;export{L as Dispose,C as GetParametersForVirtualScrollingRequest,B as HasParametersForVirtualScrollingRequest,E as Init,w as ScrollToSelectedItem};
